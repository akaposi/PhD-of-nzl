\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaSymbol{\{-\#} \AgdaKeyword{OPTIONS} --type-in-type \AgdaSymbol{\#-\}}\<%
\\
%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Level}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \AgdaSymbol{as} \AgdaModule{PE} \AgdaKeyword{hiding} \AgdaSymbol{(}refl \AgdaSymbol{;} sym \AgdaSymbol{;} trans\AgdaSymbol{;} isEquivalence\AgdaSymbol{;} [\_]\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{CwF-setoidwo} \AgdaSymbol{(}\AgdaBound{ext} \AgdaSymbol{:} \AgdaFunction{Extensionality} \AgdaPrimitive{zero} \AgdaPrimitive{zero}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Cats.Category}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Cats.Functor} \AgdaKeyword{renaming} \AgdaSymbol{(}Functor \AgdaSymbol{to} \_⇨\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Cats.Duality}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}<\_,\_> \AgdaSymbol{to} ⟨\_,\_⟩\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Function}\<%
\\
%
\\
\>\AgdaComment{-- open import Relation.Binary}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.Core} \AgdaKeyword{using} \AgdaSymbol{(}\_≡\_\AgdaSymbol{;} \_≢\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Unit}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{CategoryOfSetoid} \AgdaBound{ext} \AgdaKeyword{public}\<%
\\
%
\\
\>\AgdaComment{-- open import HProp ext}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{CwF} \AgdaKeyword{hiding} \AgdaSymbol{(}\_⇉\_\AgdaSymbol{)}\<%
\\
%
\\
\>\<\end{code}
}

\section{Categories with families}

Context are interpreted as setoids

\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{Con} \AgdaSymbol{=} \AgdaRecord{HSetoid}\<%
\\
%
\\
\>\<\end{code}

Types are functors from $\Gamma → \mathbf{Std}$

\begin{code}\>\<%
\\
%
\\
\>\AgdaKeyword{record} \AgdaRecord{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{)} \AgdaSymbol{:} \AgdaPrimitiveType{Set₁} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{fm} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣} \AgdaSymbol{→} \AgdaRecord{HSetoid}\<%
\\
%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{substT} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \<[29]%
\>[29]\<%
\\
\>[4]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y} \AgdaSymbol{→}\<%
\\
\>[4]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{∣} \AgdaBound{fm} \AgdaBound{x} \AgdaFunction{∣} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{fm} \AgdaBound{y} \AgdaFunction{∣}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{subst*} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{\{}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{[} \AgdaBound{fm} \AgdaBound{x} \AgdaFunction{]} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{b} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{[} \AgdaBound{fm} \AgdaBound{y} \AgdaFunction{]} \AgdaBound{substT} \AgdaBound{p} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{substT} \AgdaBound{p} \AgdaBound{b}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{refl*} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaSymbol{∀(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{)(}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{→} \<[42]%
\>[42]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{[} \AgdaBound{fm} \AgdaBound{x} \AgdaFunction{]} \AgdaBound{substT} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]refl} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{a}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{trans*} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{\{}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y}\AgdaSymbol{\}\{}\AgdaBound{q} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{y} \AgdaFunction{≈} \AgdaBound{z}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{→} \<[30]%
\>[30]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{[} \AgdaBound{fm} \AgdaBound{z} \AgdaFunction{]} \AgdaBound{substT} \AgdaBound{q} \AgdaSymbol{(}\AgdaBound{substT} \AgdaBound{p} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{≈} \AgdaBound{substT} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]trans} \AgdaBound{p} \AgdaBound{q}\AgdaSymbol{)} \AgdaBound{a}\<%
\\
%
\\
\>\<\end{code}

Proof-irrelevance lemmas for substT

\begin{code}\>\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-pi} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{p} \AgdaBound{q} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{\}} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{y} \AgdaFunction{]} \AgdaFunction{substT} \AgdaBound{p} \AgdaBound{a} \AgdaFunction{≈} \AgdaFunction{substT} \AgdaBound{q} \AgdaBound{a}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-pi} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{p}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{q}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \<[31]%
\>[31]\<%
\\
\>[2]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{=} \AgdaFunction{reflexive} \AgdaSymbol{(}\AgdaFunction{fm} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{PI} \AgdaBound{Γ} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{substT} \AgdaBound{x} \AgdaBound{a}\AgdaSymbol{))}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-pi'} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{\{}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{x}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{]} \AgdaFunction{substT} \AgdaBound{p} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{a}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-pi'} \AgdaSymbol{=} \AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaFunction{subst-pi} \AgdaSymbol{(}\AgdaFunction{refl*} \AgdaSymbol{\_} \AgdaSymbol{\_)}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-pi*} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{\{}\AgdaBound{p} \AgdaBound{q} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{\{}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{]} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{b} \AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{y} \AgdaFunction{]} \AgdaFunction{substT} \AgdaBound{p} \AgdaBound{a} \AgdaFunction{≈} \AgdaFunction{substT} \AgdaBound{q} \AgdaBound{b}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-pi*} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{subst*} \AgdaSymbol{\_} \AgdaBound{eq}\AgdaSymbol{)} \AgdaFunction{subst-pi}\<%
\\
%
\\
%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{trans-refl} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y}\AgdaSymbol{\}\{}\AgdaBound{q} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{y} \AgdaFunction{≈} \AgdaBound{x}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \<[31]%
\>[31]\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{]} \AgdaFunction{substT} \AgdaBound{q} \AgdaSymbol{(}\AgdaFunction{substT} \AgdaBound{p} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{≈} \AgdaBound{a}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{trans-refl} \AgdaSymbol{=} \AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{trans*} \AgdaSymbol{\_)} \AgdaFunction{subst-pi'}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-mir1} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y}\AgdaSymbol{\}\{}\AgdaBound{q} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{y} \AgdaFunction{≈} \AgdaBound{x}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{y} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \<[45]%
\>[45]\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{]} \AgdaBound{a} \AgdaFunction{≈} \AgdaFunction{substT} \AgdaBound{q} \AgdaBound{b} \AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{y} \AgdaFunction{]} \AgdaFunction{substT} \AgdaBound{p} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{b}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-mir1} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{subst*} \AgdaSymbol{\_} \AgdaBound{eq}\AgdaSymbol{)} \AgdaFunction{trans-refl}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-mir2} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y}\AgdaSymbol{\}\{}\AgdaBound{q} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{y} \AgdaFunction{≈} \AgdaBound{x}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{∣}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{y} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \<[45]%
\>[45]\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{y} \AgdaFunction{]} \AgdaFunction{substT} \AgdaBound{p} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{b} \AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{]} \AgdaBound{a} \AgdaFunction{≈} \AgdaFunction{substT} \AgdaBound{q} \AgdaBound{b}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{subst-mir2} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaFunction{subst-mir1} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]sym} \AgdaBound{eq}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaModule{Ty} \AgdaKeyword{public} \<[15]%
\>[15]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{renaming} \AgdaSymbol{(}substT \AgdaSymbol{to} [\_]subst\AgdaSymbol{;} subst* \AgdaSymbol{to} [\_]subst*\AgdaSymbol{;} fm \AgdaSymbol{to} [\_]fm \AgdaSymbol{;}
            refl* \AgdaSymbol{to} [\_]refl* \AgdaSymbol{;} trans* \AgdaSymbol{to} [\_]trans*\AgdaSymbol{;} 
            subst-pi \AgdaSymbol{to} [\_]subst-pi \AgdaSymbol{;}
            subst-pi' \AgdaSymbol{to} [\_]subst-pi' \AgdaSymbol{;} subst-pi* \AgdaSymbol{to} [\_]subst-pi* \AgdaSymbol{;}
            trans-refl \AgdaSymbol{to} [\_]trans-refl \AgdaSymbol{;} subst-mir1 \AgdaSymbol{to} [\_]subst-mir1 \AgdaSymbol{;}
            subst-mir2 \AgdaSymbol{to} [\_]subst-mir2\AgdaSymbol{)}\<%
\\
\>\<\end{code}

Type substitution

\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{\_[\_]T} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaRecord{Ty} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaRecord{⇉} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaRecord{Ty} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{\_[\_]T} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaBound{A} \AgdaBound{f}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{=} \AgdaKeyword{record}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{\{} \AgdaField{fm} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaFunction{fm} \AgdaFunction{∘} \AgdaFunction{fn}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{;} \AgdaField{substT} \AgdaSymbol{=} \AgdaFunction{substT} \AgdaFunction{∘} \AgdaFunction{resp}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{;} \AgdaField{subst*} \AgdaSymbol{=} \AgdaFunction{subst*} \AgdaFunction{∘} \AgdaFunction{resp}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{;} \AgdaField{refl*} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{\_} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{subst-pi'}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{;} \AgdaField{trans*} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{(}\AgdaFunction{fn} \AgdaSymbol{\_)} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{trans*} \AgdaSymbol{\_)} \AgdaFunction{subst-pi}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaKeyword{where} \<[11]%
\>[11]\<%
\\
\>[5]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaKeyword{open} \AgdaModule{Ty} \AgdaBound{A}\<%
\\
\>[5]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaKeyword{open} \AgdaModule{\_⇉\_} \AgdaBound{f}\<%
\\
%
\\
\>\<\end{code}

Terms

\begin{code}\>\<%
\\
%
\\
\>\AgdaKeyword{record} \AgdaRecord{Tm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{constructor} \AgdaInductiveConstructor{tm:\_resp:\_}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{tm} \<[10]%
\>[10]\AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaFunction{∣}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{respt} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \<[30]%
\>[30]\<%
\\
\>[4]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]} \AgdaBound{x} \AgdaFunction{≈} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{→} \<[30]%
\>[30]\<%
\\
\>[4]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{y} \AgdaFunction{]} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{tm} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{≈} \AgdaBound{tm} \AgdaBound{y}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaModule{Tm} \AgdaKeyword{public} \AgdaKeyword{renaming} \AgdaSymbol{(}tm \AgdaSymbol{to} [\_]tm \AgdaSymbol{;} respt \AgdaSymbol{to} [\_]respt\AgdaSymbol{)}\<%
\\
%
\\
\>\<\end{code}

Term substitution

\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{\_[\_]m} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaRecord{Tm} \AgdaBound{A} \<[39]%
\>[39]\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaRecord{⇉} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{\_[\_]m} \AgdaBound{t} \AgdaBound{f} \AgdaSymbol{=} \AgdaKeyword{record} \<[19]%
\>[19]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{} \AgdaField{tm} \AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{t} \AgdaFunction{]tm} \AgdaFunction{∘} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]fn}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{;} \AgdaField{respt} \AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{t} \AgdaFunction{]respt} \AgdaFunction{∘} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]resp} \<[43]%
\>[43]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\}}\<%
\\
\>\<\end{code}

Context comprehension

\begin{code}\>\<%
\\
\>[0]\AgdaIndent{1}{}\<[1]%
\>[1]\<%
\\
\>\AgdaFunction{\_\&\_} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{Ty} \AgdaBound{Γ} \AgdaSymbol{→} \AgdaRecord{HSetoid}\<%
\\
\>\AgdaBound{Γ} \AgdaFunction{\&} \AgdaBound{A} \AgdaSymbol{=} \AgdaKeyword{record} \<[15]%
\>[15]\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{\{} \AgdaField{Carrier} \AgdaSymbol{=} \AgdaRecord{Σ[} \AgdaBound{x} \AgdaRecord{∶} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣} \AgdaRecord{]} \AgdaFunction{∣} \AgdaFunction{fm} \AgdaBound{x} \AgdaFunction{∣}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{;} \AgdaField{\_≈h\_} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaSymbol{λ\{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{→} \<[37]%
\>[37]\<%
\\
\>[7]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{Σ'[} \AgdaBound{p} \AgdaFunction{∶} \AgdaBound{x} \AgdaFunction{≈h} \AgdaBound{y} \AgdaFunction{]} \AgdaFunction{[} \AgdaFunction{fm} \AgdaBound{y} \AgdaFunction{]} \AgdaFunction{substT} \AgdaBound{p} \AgdaBound{a} \AgdaFunction{≈h} \AgdaBound{b}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{;} \AgdaField{refl} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaFunction{refl} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{refl*} \AgdaSymbol{\_} \AgdaSymbol{\_)}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{;} \AgdaField{sym} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{p}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \<[40]%
\>[40]\<%
\\
\>[7]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{subst*} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]sym} \AgdaBound{q}\AgdaSymbol{))} \AgdaFunction{trans-refl} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{;} \AgdaField{trans} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{m} \AgdaInductiveConstructor{,} \AgdaBound{n}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{trans} \AgdaBound{p} \AgdaBound{m} \AgdaInductiveConstructor{,} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{fm} \AgdaSymbol{\_} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaFunction{trans*} \AgdaSymbol{\_))}\<%
\\
\>[0]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{subst*} \AgdaSymbol{\_} \AgdaBound{q}\AgdaSymbol{))} \AgdaBound{n} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaKeyword{where} \<[13]%
\>[13]\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaKeyword{open} \AgdaModule{HSetoid} \AgdaBound{Γ}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaKeyword{open} \AgdaModule{Ty} \AgdaBound{A} \<[23]%
\>[23]\<%
\\
%
\\
\>\AgdaKeyword{infixl} \AgdaNumber{5} \_\&\_\<%
\\
%
\\
\>\AgdaFunction{fst\&} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaFunction{\&} \AgdaBound{A} \AgdaRecord{⇉} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{fst\&} \AgdaSymbol{=} \AgdaKeyword{record} \<[14]%
\>[14]\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{} \AgdaField{fn} \AgdaSymbol{=} \AgdaFunction{proj₁}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{;} \AgdaField{resp} \AgdaSymbol{=} \AgdaFunction{proj₁}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\}}\<%
\\
%
\\
\>\<\end{code}

Pairing operation

\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{\_,,\_} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaRecord{⇉} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaRecord{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]T}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaRecord{⇉} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaFunction{\&} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaBound{f} \AgdaFunction{,,} \AgdaBound{t} \AgdaSymbol{=} \AgdaKeyword{record} \<[16]%
\>[16]\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{} \AgdaField{fn} \AgdaSymbol{=} \AgdaFunction{⟨} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]fn} \AgdaFunction{,} \AgdaFunction{[} \AgdaBound{t} \AgdaFunction{]tm} \AgdaFunction{⟩}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{;} \AgdaField{resp} \AgdaSymbol{=} \AgdaFunction{⟨} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]resp} \AgdaFunction{,} \AgdaFunction{[} \AgdaBound{t} \AgdaFunction{]respt} \AgdaFunction{⟩}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\}}\<%
\\
%
\\
\>\<\end{code}

Projections

\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{fst} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaRecord{⇉} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaFunction{\&} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaRecord{⇉} \AgdaBound{Δ}\<%
\\
\>\AgdaFunction{fst} \AgdaBound{f} \AgdaSymbol{=} \AgdaKeyword{record} \<[15]%
\>[15]\<%
\\
\>[-6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{} \AgdaField{fn} \AgdaSymbol{=} \AgdaFunction{proj₁} \AgdaFunction{∘} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]fn}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{;} \AgdaField{resp} \AgdaSymbol{=} \AgdaFunction{proj₁} \AgdaFunction{∘} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]resp} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\}}\<%
\\
%
\\
%
\\
\>\AgdaFunction{snd} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaRecord{⇉} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaFunction{\&} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaRecord{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaFunction{fst} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{f} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{snd} \AgdaBound{f} \AgdaSymbol{=} \AgdaKeyword{record} \<[15]%
\>[15]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{} \AgdaField{tm} \AgdaSymbol{=} \AgdaFunction{proj₂} \AgdaFunction{∘} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]fn}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{;} \AgdaField{respt} \AgdaSymbol{=} \AgdaFunction{proj₂} \AgdaFunction{∘} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]resp} \<[36]%
\>[36]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\}}\<%
\\
%
\\
%
\\
\>\AgdaFunction{\_\textasciicircum\_} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaRecord{⇉} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaFunction{\&} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]T} \AgdaRecord{⇉} \AgdaBound{Δ} \AgdaFunction{\&} \AgdaBound{A}\<%
\\
\>\AgdaBound{f} \AgdaFunction{\textasciicircum} \AgdaBound{A} \AgdaSymbol{=} \AgdaKeyword{record} \<[15]%
\>[15]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{} \AgdaField{fn} \AgdaSymbol{=} \AgdaFunction{⟨} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]fn} \AgdaFunction{∘} \AgdaFunction{proj₁} \AgdaFunction{,} \AgdaFunction{proj₂} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{;} \AgdaField{resp} \AgdaSymbol{=} \AgdaFunction{⟨} \AgdaFunction{[} \AgdaBound{f} \AgdaFunction{]resp} \AgdaFunction{∘} \AgdaFunction{proj₁} \AgdaFunction{,} \AgdaFunction{proj₂} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\}}\<%
\\
%
\\
\>\<\end{code}

$\Pi$-types (object level)

\begin{code}\>\<%
\\
%
\\
%
\\
\>\AgdaFunction{Π} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{\&} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaRecord{Ty} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{Π} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaBound{A} \AgdaBound{B} \AgdaSymbol{=} \AgdaKeyword{record} \<[19]%
\>[19]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{\{} \AgdaField{fm} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaKeyword{let} \AgdaBound{Ax} \AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaKeyword{in}\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaKeyword{let} \AgdaBound{Bx} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaKeyword{in}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaKeyword{record}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{} \AgdaField{Carrier} \AgdaSymbol{=} \AgdaRecord{Σ[} \AgdaBound{fn} \AgdaRecord{∶} \AgdaSymbol{((}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Ax} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{Bx} \AgdaBound{a} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaRecord{]}\<%
\\
\>[9]\AgdaIndent{21}{}\<[21]%
\>[21]\AgdaSymbol{((}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Ax} \AgdaFunction{∣}\AgdaSymbol{)}\<%
\\
\>[9]\AgdaIndent{21}{}\<[21]%
\>[21]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Ax} \AgdaFunction{]} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[9]\AgdaIndent{21}{}\<[21]%
\>[21]\AgdaFunction{[} \AgdaBound{Bx} \AgdaBound{b} \AgdaFunction{]} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]refl} \AgdaInductiveConstructor{,} \<[54]%
\>[54]\<%
\\
\>[9]\AgdaIndent{21}{}\<[21]%
\>[21]\AgdaFunction{[} \AgdaBound{Ax} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]refl*} \AgdaBound{x} \AgdaBound{a}\AgdaSymbol{)} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{fn} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{≈} \AgdaBound{fn} \AgdaBound{b}\AgdaSymbol{)} \<[68]%
\>[68]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{;} \AgdaField{\_≈h\_} \<[19]%
\>[19]\AgdaSymbol{=} \AgdaSymbol{λ\{(}\AgdaBound{f} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaSymbol{(}\AgdaBound{g} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{21}{}\<[21]%
\>[21]\AgdaFunction{∀'[} \AgdaBound{a} \AgdaFunction{∶} \AgdaSymbol{\_} \AgdaFunction{]} \AgdaFunction{[} \AgdaBound{Bx} \AgdaBound{a} \AgdaFunction{]} \AgdaBound{f} \AgdaBound{a} \AgdaFunction{≈h} \AgdaBound{g} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{;} \AgdaField{refl} \<[19]%
\>[19]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{Bx} \AgdaBound{a} \AgdaFunction{]refl} \<[40]%
\>[40]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{;} \AgdaField{sym} \<[19]%
\>[19]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{f} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{Bx} \AgdaBound{a} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{;} \AgdaField{trans} \<[19]%
\>[19]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{f} \AgdaBound{g} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{Bx} \AgdaBound{a} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{g} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\}}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{;} \AgdaField{substT} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{p} \<[25]%
\>[25]\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{→} \AgdaKeyword{let} \AgdaBound{y2x} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]sym} \AgdaBound{p}\AgdaSymbol{)} \AgdaBound{a} \AgdaKeyword{in}\<%
\\
\>[15]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaKeyword{let} \AgdaBound{x2y} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst} \AgdaBound{p} \AgdaBound{a} \AgdaKeyword{in}\<%
\\
\>[15]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaKeyword{let} \AgdaBound{p'} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]trans-refl} \AgdaKeyword{in}\<%
\\
\>[-11]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{λ\{(}\AgdaBound{f} \AgdaInductiveConstructor{,} \AgdaBound{rsp}\AgdaSymbol{)} \AgdaSymbol{→} \<[28]%
\>[28]\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst} \AgdaSymbol{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{p'} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{(}\AgdaBound{y2x} \AgdaBound{a}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaInductiveConstructor{,} \<[49]%
\>[49]\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{(λ} \AgdaBound{a} \AgdaBound{b} \AgdaBound{q} \AgdaSymbol{→} \<[26]%
\>[26]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaKeyword{let} \AgdaBound{a'} \AgdaSymbol{=} \AgdaBound{y2x} \AgdaBound{a} \AgdaKeyword{in} \<[34]%
\>[34]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaKeyword{let} \AgdaBound{b'} \AgdaSymbol{=} \AgdaBound{y2x} \AgdaBound{b} \AgdaKeyword{in}\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaKeyword{let} \AgdaBound{q'} \AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst*} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]sym} \AgdaBound{p}\AgdaSymbol{)} \AgdaBound{q} \AgdaKeyword{in}\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaKeyword{let} \AgdaBound{H} \AgdaSymbol{=} \AgdaBound{rsp} \AgdaBound{a'} \AgdaBound{b'} \AgdaBound{q'} \AgdaKeyword{in}\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaKeyword{let} \AgdaBound{r} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{\&} \AgdaBound{A} \AgdaFunction{]} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{b'}\AgdaSymbol{)} \AgdaFunction{≈} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{b}\AgdaSymbol{)}
                    r \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{p'} \AgdaBound{b}\AgdaSymbol{)} \AgdaKeyword{in}\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaKeyword{let} \AgdaBound{pre} \AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst*} \AgdaBound{r} \AgdaBound{H} \AgdaKeyword{in}\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{b}\AgdaSymbol{)} \AgdaFunction{]trans} \<[41]%
\>[41]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_)} \<[48]%
\>[48]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{b}\AgdaSymbol{)} \AgdaFunction{]trans} \<[42]%
\>[42]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi} \<[30]%
\>[30]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{b}\AgdaSymbol{)} \AgdaFunction{]trans} \<[42]%
\>[42]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{,} \AgdaBound{b}\AgdaSymbol{)} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_))} \<[57]%
\>[57]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaBound{pre}\AgdaSymbol{))} \<[23]%
\>[23]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{)} \<[22]%
\>[22]\<%
\\
\>[-12]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{;} \AgdaField{subst*} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{\_} \AgdaBound{q} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst*} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaBound{q} \AgdaSymbol{\_)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{;} \AgdaField{refl*} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{(}\AgdaBound{f} \AgdaInductiveConstructor{,} \AgdaBound{rsp}\AgdaSymbol{)} \AgdaBound{a} \<[29]%
\>[29]\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi} \<[47]%
\>[47]\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{(}\AgdaBound{rsp} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]sym} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]refl}\AgdaSymbol{)} \AgdaBound{a}\AgdaSymbol{)} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst-pi'}\AgdaSymbol{)} \<[72]%
\>[72]\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{;} \AgdaField{trans*} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{f} \AgdaInductiveConstructor{,} \AgdaBound{rsp}\AgdaSymbol{)} \AgdaBound{a} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[32]%
\>[32]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_)} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[51]%
\>[51]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_)} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi}\AgdaSymbol{)))} \<[46]%
\>[46]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst*} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaBound{rsp} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[57]%
\>[57]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]trans*} \AgdaSymbol{\_)} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst-pi}\AgdaSymbol{)))} \AgdaSymbol{\}} \<[48]%
\>[48]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaFunction{lam} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{\&} \AgdaBound{A}\AgdaSymbol{)\}} \AgdaSymbol{→} \AgdaRecord{Tm} \AgdaBound{B} \AgdaSymbol{→} \AgdaRecord{Tm} \AgdaSymbol{(}\AgdaFunction{Π} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lam} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{tm:} \AgdaBound{tm} \AgdaInductiveConstructor{resp:} \AgdaBound{respt}\AgdaSymbol{)} \AgdaSymbol{=} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{record} \AgdaSymbol{\{} \AgdaField{tm} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaBound{tm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{))} \<[41]%
\>[41]\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaInductiveConstructor{,} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaBound{b} \AgdaBound{p} \AgdaSymbol{→} \AgdaBound{respt} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]refl} \AgdaInductiveConstructor{,} \<[48]%
\>[48]\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]refl*} \AgdaSymbol{\_} \AgdaSymbol{\_)} \AgdaBound{p}\AgdaSymbol{))}\<%
\\
\>[5]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{;} \AgdaField{respt} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{p} \AgdaBound{\_} \AgdaSymbol{→} \AgdaBound{respt} \AgdaSymbol{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]trans-refl}\AgdaSymbol{)} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaFunction{app} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{\&} \AgdaBound{A}\AgdaSymbol{)\}} \AgdaSymbol{→} \AgdaRecord{Tm} \AgdaSymbol{(}\AgdaFunction{Π} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{Tm} \AgdaBound{B}\<%
\\
\>\AgdaFunction{app} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{tm:} \AgdaBound{tm} \AgdaInductiveConstructor{resp:} \AgdaBound{respt}\AgdaSymbol{)} \AgdaSymbol{=} \<[39]%
\>[39]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{record} \AgdaSymbol{\{} \AgdaField{tm} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{proj₁} \AgdaSymbol{(}\AgdaBound{tm} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{;} \AgdaField{respt} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{y}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{tr}\AgdaSymbol{)} \AgdaSymbol{→} \<[45]%
\>[45]\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaKeyword{let} \AgdaBound{fresp} \AgdaSymbol{=} \AgdaFunction{proj₂} \AgdaSymbol{(}\AgdaBound{tm} \AgdaSymbol{(}\AgdaFunction{proj₁} \AgdaBound{x}\AgdaSymbol{))} \AgdaKeyword{in}\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[36]%
\>[36]\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst*} \AgdaSymbol{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{tr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]sym} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi'}\AgdaSymbol{))} \<[74]%
\>[74]\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans}\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\{}p \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]refl} \AgdaInductiveConstructor{,} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]refl*} \AgdaSymbol{\_} \AgdaSymbol{\_)\}} \AgdaSymbol{\_)}\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[37]%
\>[37]\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi} \<[31]%
\>[31]\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[37]%
\>[37]\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\{}q \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]trans-refl}\AgdaSymbol{)\}} \AgdaSymbol{\_))}\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[37]%
\>[37]\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi*} \AgdaSymbol{(}\AgdaBound{fresp} \AgdaSymbol{\_} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst-mir2} \AgdaBound{tr}\AgdaSymbol{)))} \<[67]%
\>[67]\<%
\\
\>[9]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaBound{respt} \AgdaBound{p} \AgdaSymbol{\_)))))} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\}}\<%
\\
%
\\
\>\<\end{code}

Verification of β causes stack overflow

\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{\_⇒\_} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{Ty} \AgdaBound{Γ}\<%
\\
\>\AgdaBound{A} \AgdaFunction{⇒} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{Π} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{B} \AgdaFunction{[} \AgdaFunction{fst\&} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaBound{A}\AgdaSymbol{\}} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{infixr} \AgdaNumber{6} \_⇒\_\<%
\\
\>\<\end{code}

Simpler definition for functions

\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{[\_,\_]\_⇒fm\_} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{)(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Γ} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{HSetoid} \AgdaSymbol{→} \AgdaRecord{HSetoid} \AgdaSymbol{→} \AgdaRecord{HSetoid}\<%
\\
\>\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{,} \AgdaBound{x} \AgdaFunction{]} \AgdaBound{Ax} \AgdaFunction{⇒fm} \AgdaBound{Bx} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaKeyword{record}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\{} \AgdaField{Carrier} \AgdaSymbol{=} \AgdaRecord{Σ[} \AgdaBound{fn} \AgdaRecord{∶} \AgdaSymbol{(}\AgdaFunction{∣} \AgdaBound{Ax} \AgdaFunction{∣} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{Bx} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaRecord{]} \AgdaSymbol{((}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{Ax} \AgdaFunction{∣}\AgdaSymbol{)}\<%
\\
\>[6]\AgdaIndent{18}{}\<[18]%
\>[18]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaFunction{[} \AgdaBound{Ax} \AgdaFunction{]} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{Bx} \AgdaFunction{]} \AgdaBound{fn} \AgdaBound{a} \AgdaFunction{≈} \AgdaBound{fn} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{;} \AgdaField{\_≈h\_} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaSymbol{λ\{(}\AgdaBound{f} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaSymbol{(}\AgdaBound{g} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaSymbol{→} \AgdaFunction{∀'[} \AgdaBound{a} \AgdaFunction{∶} \AgdaSymbol{\_} \AgdaFunction{]} \AgdaFunction{[} \AgdaBound{Bx} \AgdaFunction{]} \AgdaBound{f} \AgdaBound{a} \AgdaFunction{≈h} \AgdaBound{g} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{;} \AgdaField{refl} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{\_} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{Bx} \AgdaFunction{]refl} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{;} \AgdaField{sym} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{f} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{Bx} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{;} \AgdaField{trans} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{f} \AgdaBound{g} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{Bx} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{g} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\}}\<%
\\
%
\\
\>\<\end{code}

$\Sigma$-types (object level)

\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{Σ''} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaFunction{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{\&} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaRecord{Ty} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{Σ''} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaBound{A} \AgdaBound{B} \AgdaSymbol{=} \AgdaKeyword{record} \<[21]%
\>[21]\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{} \AgdaField{fm} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaKeyword{let} \AgdaBound{Ax} \AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaKeyword{in}\<%
\\
\>[8]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaKeyword{let} \AgdaBound{Bx} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaKeyword{in}\<%
\\
\>[-2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaKeyword{record}\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{\{} \AgdaField{Carrier} \AgdaSymbol{=} \AgdaRecord{Σ[} \AgdaBound{a} \AgdaRecord{∶} \AgdaFunction{∣} \AgdaBound{Ax} \AgdaFunction{∣} \AgdaRecord{]} \AgdaFunction{∣} \AgdaBound{Bx} \AgdaBound{a} \AgdaFunction{∣}\<%
\\
%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{;} \AgdaField{\_≈h\_} \<[21]%
\>[21]\AgdaSymbol{=} \AgdaSymbol{λ\{(}\AgdaBound{a₁} \AgdaInductiveConstructor{,} \AgdaBound{b₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{a₂} \AgdaInductiveConstructor{,} \AgdaBound{b₂}\AgdaSymbol{)} \AgdaSymbol{→} \<[47]%
\>[47]\<%
\\
\>[11]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaFunction{Σ'[} \AgdaBound{eq₁} \AgdaFunction{∶} \AgdaFunction{[} \AgdaBound{Ax} \AgdaFunction{]} \AgdaBound{a₁} \AgdaFunction{≈h} \AgdaBound{a₂} \AgdaFunction{]} \<[51]%
\>[51]\<%
\\
\>[11]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaFunction{[} \AgdaBound{Bx} \AgdaBound{a₂} \AgdaFunction{]} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst} \<[44]%
\>[44]\<%
\\
\>[11]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]refl} \AgdaInductiveConstructor{,} \AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaFunction{]trans} \<[55]%
\>[55]\<%
\\
\>[11]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]refl*} \AgdaBound{x} \AgdaBound{a₁}\AgdaSymbol{)} \AgdaBound{eq₁}\AgdaSymbol{)} \AgdaBound{b₁} \AgdaFunction{≈h} \AgdaBound{b₂} \AgdaSymbol{\}}\<%
\\
%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{;} \AgdaField{refl} \<[21]%
\>[21]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{}\AgdaBound{t}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaFunction{]refl} \AgdaInductiveConstructor{,} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi'}\<%
\\
%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{;} \AgdaField{sym} \<[21]%
\>[21]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaFunction{]sym} \AgdaBound{p}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \<[59]%
\>[59]\<%
\\
\>[11]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-mir1} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaFunction{]sym} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{\}}\<%
\\
%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{;} \AgdaField{trans} \<[21]%
\>[21]\AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{r} \AgdaInductiveConstructor{,} \AgdaBound{s}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaFunction{]trans} \AgdaBound{p} \AgdaBound{r}\AgdaSymbol{)} \AgdaInductiveConstructor{,}\<%
\\
\>[0]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaFunction{]trans} \<[49]%
\>[49]\<%
\\
\>[0]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaFunction{]trans}\<%
\\
\>[0]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaFunction{]trans} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi}\<%
\\
\>[0]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{,} \AgdaSymbol{\_)} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \<[60]%
\>[60]\<%
\\
\>[0]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{\{}q \AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{Γ} \AgdaFunction{]refl} \AgdaInductiveConstructor{,} \AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaBound{x} \AgdaFunction{]trans} \<[59]%
\>[59]\<%
\\
\>[0]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]refl*} \AgdaBound{x} \AgdaSymbol{\_)} \AgdaBound{r}\AgdaSymbol{\}} \AgdaSymbol{\_)))} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi*} \AgdaBound{q}\AgdaSymbol{))} \AgdaBound{s}\AgdaSymbol{)\}}\<%
\\
%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{\}}\<%
\\
%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{;} \AgdaField{substT} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{x≈y} \AgdaSymbol{→} \AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{→} \<[40]%
\>[40]\<%
\\
\>[8]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst} \AgdaBound{x≈y} \AgdaBound{p}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst} \AgdaSymbol{(}\AgdaBound{x≈y} \AgdaInductiveConstructor{,} \<[58]%
\>[58]\<%
\\
\>[8]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]refl}\AgdaSymbol{)} \AgdaBound{q}\AgdaSymbol{\}}\<%
\\
%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{;} \AgdaField{subst*} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{x≈y} \AgdaSymbol{→} \<[28]%
\>[28]\AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]subst*} \AgdaBound{x≈y} \AgdaBound{p} \AgdaInductiveConstructor{,} \<[61]%
\>[61]\<%
\\
\>[0]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \<[58]%
\>[58]\<%
\\
\>[0]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_)} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi} \<[69]%
\>[69]\<%
\\
\>[0]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]sym} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_))))} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst*} \<[69]%
\>[69]\<%
\\
\>[0]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{(}\AgdaBound{x≈y} \AgdaInductiveConstructor{,} \AgdaFunction{[} \AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]refl}\AgdaSymbol{)} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{;} \AgdaField{refl*} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{x} \AgdaSymbol{→} \<[25]%
\>[25]\AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]refl*} \AgdaSymbol{\_} \AgdaSymbol{\_)} \AgdaInductiveConstructor{,} \<[57]%
\>[57]\<%
\\
\>[0]\AgdaIndent{18}{}\<[18]%
\>[18]\AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_)} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi'}\AgdaSymbol{)\}}\<%
\\
%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{;} \AgdaField{trans*} \AgdaSymbol{=} \<[20]%
\>[20]\AgdaSymbol{λ} \AgdaSymbol{\{(}\AgdaBound{p} \AgdaInductiveConstructor{,} \AgdaBound{q}\AgdaSymbol{)} \<[32]%
\>[32]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{A} \AgdaFunction{]trans*} \AgdaSymbol{\_)} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans}\<%
\\
\>[0]\AgdaIndent{20}{}\<[20]%
\>[20]\AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_)} \AgdaSymbol{(}\AgdaFunction{[} \AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]fm} \AgdaSymbol{\_} \AgdaFunction{]trans} \AgdaSymbol{(}\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]trans*} \AgdaSymbol{\_)}\<%
\\
\>[0]\AgdaIndent{20}{}\<[20]%
\>[20]\AgdaFunction{[} \AgdaBound{B} \AgdaFunction{]subst-pi}\AgdaSymbol{))} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\}}\<%
\\
%
\\
\>\<\end{code}


\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaComment{\{-
module TypeTerm-Equality
  (Ty-ExtEq : \{Γ : Con\}\{A B : Ty Γ\} →
              (p : [ A ]fm ≡ [ B ]fm) →
              (∀\{x\}\{y\}(xy : [ Γ ] x ≈ y)(fx : ∣ [ A ]fm x ∣) → subst (λ fm → ∣ fm y ∣) p ([ A ]subst xy fx) ≡ [ B ]subst xy (subst (λ fm → ∣ fm x ∣) p fx)) →
           A ≡ B)
  (Tm-ExtEq : \{Γ : Con\}\{A : Ty Γ\}\{t r : Tm A\} →
              ([ t ]tm ≡ [ r ]tm) →
              t ≡ r) where

  Fid : \{Γ : Con\}\{A : Ty Γ\} → A [ idCH ] ≡ A
  Fid = Ty-ExtEq PE.refl (λ xy fx → PE.refl)

  Fcomp : \{Γ Δ Φ : Con\}\{A : Ty Γ\}(f : Δ ⇉ Γ)(g : Φ ⇉ Δ) → A [ f ∘c g ] ≡ A [ f ] [ g ]
  Fcomp f g = Ty-ExtEq PE.refl (λ xy fx → PE.refl) 


  Tm-ExtEq-TyDif : \{Γ : Con\}\{A B : Ty Γ\}\{t : Tm A\}\{r : Tm B\} → (eq : A ≡ B) → 
                   (∀ x → subst (λ ty → ∣ [ ty ]fm x ∣) eq ([ t ]tm x) ≡ [ r ]tm x) → 
                   (subst Tm eq t ≡ r)
  Tm-ExtEq-TyDif PE.refl f = Tm-ExtEq (ext f)


  Fidm : \{Γ : Con\}\{A : Ty Γ\}(t : Tm A) → (subst Tm Fid (t [ idCH ]m)) ≡ t
  Fidm t = Tm-ExtEq-TyDif Fid (λ x → \{!!\}) -- Tm-ExtEq-TyDif Fid (λ x → \{!trans!\})

  Fcompm : \{Γ Δ Φ : Con\}\{A : Ty Γ\}\{t : Tm A\}(f : Δ ⇉ Γ)(g : Φ ⇉ Δ) → subst Tm (Fcomp f g) (t [ f ∘c g ]m) ≡ t [ f ]m [ g ]m
  Fcompm f g = \{!!\} 
 
-- verify Π types are consistent with substitution

  Pi-Sub : \{Γ Δ : Con\}(A : Ty Γ)(B : Ty (Γ \& A))(f : Δ ⇉ Γ) →
          (Π A B) [ f ] ≡ Π (A [ f ]) (B [ f \textasciicircum A ])
  Pi-Sub A B f = Ty-ExtEq \{!ext!\} \{!!\}

-\}}\<%
\\
%
\\
\>\<\end{code}
}