\chapter{Syntactic $\omega$-groupoids}
\label{wog}



%why do we need to use omega groupoid


In Type Theory, a type can be interpreted as a setoid which is a set equipped with an equivalence relation \cite{alti:lics99}.
The equivalence proof of the relation consists of reflexivity, symmetry and transitivity whose proofs are unique. 
However in \hott, we reject the principle of uniqueness of identity proofs (UIP). 
Instead we accept the univalence axiom which says that equality of types is weakly equivalent to weak equivalence. 
Weak equivalence can be seen as a refinement of isomorphism without UIP \cite{txa:csl}. 
In the higher-categorical setting, weak equivalence can be thought of as arising from isomorphisms by systematically replacing equalities by higher cells.  
For example, a weak equivalence 
between two objects $A$ and $B$ in a 2-category is a morphism $f : A \rightarrow B$ which has a
corresponding inverse morphism $ g : B \rightarrow A$, but instead of the
equalities $f ∘ g = 1_B$ and $g ∘ f = 1_A$ we have 2-cell isomorphisms $f ∘ g ≅ 1_B$ and $g ∘ f ≅ 1_A$. In an $\omega$-category, these later isomorphisms are weak equivalences again. As all equivalences in this chapter are weak equivalences in this sense, from now on we say just equivalence.


Voevodsky proposed the univalence axiom which basically says that
isomorphic types are equal. This can be viewed as a strong
extensionality axiom and it does imply functional extensionality. 
(A coq proof of this can be found in \cite{uafe}) However, adding
univalence as an axiom destroys canonicity, i.e.\ that every closed
term of type $\mathbb{N}$ is reducible to a numeral. In the special
case of extensionality and assuming a strong version of UIP Altenkirch and McBride were able to eliminate this issue
\cite{alti:lics99,alti:ott-conf} using setoids. However, it is not
clear how to generalize this in the absence of UIP to univalence which
is incompatible with UIP. To solve the problem we should generalise
the notion of setoids, namely to enrich the structure of the identity
proofs.


The generalised notion is called {\wogs} and was proposed by
Grothendieck 1983 in a famous manuscript \emph{Pursuing Stacks} \cite{gro:ps}. Maltsiniotis continued his work and suggested a simplification of the original definition which can be found in \cite{mal:gwog}. Later Ara also presents a slight variation of the simplication of {\wog} in \cite{ara:wog}. Categorically speaking an $\omega$-groupoid is an $\omega$-category in which morphisms on all levels are equivalences. As we know that a set can be seen as a discrete
category, a setoid is a category where every morphism between
any two objects is unique. A groupoid is more generalised, every morphism is
an isomorphism but the proof of isomorphism is unique, namely the
composition of a morphism with its inverse is equal to the identity. Similarly, an
$n$-groupoid is an $n$-category in which morphisms on all levels are
equivalences. {\wogs} (also called $\infty$-groupoid) is an
infinite version of $n$-groupoid. The following diagram illustrates the infinite tower of equivalences, although it omits essential identity morphisms and composition of arrows.


\begin{displaymath}
\xymatrix{ 
a
\ar@/_4pc/[ddd]^p="p" 
\\
\\
\\
b 
\ar@/_4pc/[uuu]^{p^{-1}}="p^{-1}"" 
\ar@2{->} @/^2pc/ "p";"p^{-1}" _{H}="H"
\ar@2{<-} @/_2pc/ "p";"p^{-1}" ^{H ^{-1}}="H^{-1}"
\ar@3{->} @/^1pc/ "H";"H^{-1}"_{...}="A"
\ar@3{<-}@/_1pc/  "H";"H^{-1}"^{...}="A"
}
\end{displaymath} 


 To model Type Theory without UIP we
also allow the equalities to be non-strict, in other words, they are
propositional but not necessarily definitional equalities. Finally we should use {\wog} to interpret types and eliminate the univalence axiom.

There are several approaches to formalise {\wog} in Type Theory, for instance, Altenkirch and Ryp\'a\v{c}ek \cite{txa:csl}, and Brunerie's notes \cite{gb:wog}.

In this chapter, our implementation of \wog builds on the syntactic approach of
\cite{txa:csl} but simplifies it greatly following Brunerie's proposal
\cite{gb:wog} by replacing the distinct constants for each of the
higher coherence cells by a single constant $\mathsf{coh}$. In more detail, we
specify when a globular set is a {\wogs} by first defining a type
theory called {\tig} to describe the internal language of Grothendieck
{\wog}, then interpret it with a globular set and a dependent
function to it. All coherence laws of {\wog} are derivable from the
syntax, we will present some basic ones, for example reflexivity. Everything
is formalised in Agda. This is the first attempt to formalise this approach in a
dependently typed language like Agda or Coq. 
Most of the work has been published in \cite{LFMTP14} by the author, Altenkrich and  Ryp\'a\v{c}ek.
One of our main contributions is to use heterogeneous
equality for terms to overcome difficult problems encountered
when using the usual homogeneous one. We present the formalisation but
omit some complicated and less important programs, namely the
proofs of some lemmas or definitions of some auxiliary functions. For the reader who is interested in the details, you can find the complete code in \autoref{app:wog} and also online \cite{lfmtp-github}.  
M




\section{Syntax of weak {\Large$\omega$}-groupoids}\label{sec:syntax}
%
We develop the type theory of $\omega$-groupoids formally, following
\cite{gb:wog}. This is a type theory with only one type former which
we can view as equality type and interpret as the homset of the
$\omega$-groupoid. There are no definitional equalities, this
corresponds to the fact that we consider \emph{weak} $\omega$-groupoids. None of the groupoid laws on any levels are strict (i.e.\ definitional) but all are witnessed by
terms. Compared to \cite{txa:csl} the definition is greatly
simplified by the observation that all laws of a weak $\omega$-groupoid follow from the existence of coherence constants for
any contractible context.

In our formalisation we exploit the more liberal way to do mutual
definitions in Agda, which was implemented recently following up a
suggestion by the first author. It allows us to first introduce a type
former but give its definition later.

Since we are avoiding definitional equalities we have to define a
syntactic substitution operation which we need for the general
statement of the coherence constants. However, defining these
constants requires us to prove a number of substitution laws which
with the usual definition of identity types take a very
complex mutually recursive form (see \cite{txa:csl}). We address this
issue by using heterogeneous equality \cite{mcbride:elimination}. Although 
it exploits UIP, our approach is sound because UIP holds for the
syntax. See \autoref{sec:het} for a more details.





\subsection{Basic Objects}

We first declare the syntax of our type theory which is
called \tig{} namely the internal language of \wog. Since the definitions of syntactic objects involve each other, it is essential to define them in a inductive-inductive way. Agda allows us to state the types and constructors separately for involved inductive-inductive definitions. The following declarations in order are contexts as sets,
types are sets dependent on contexts, terms and variables are sets
dependent on types, context morphisms and contractible contexts.

\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Con} \<[19]%
\>[19]\AgdaSymbol{:} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)} \<[19]%
\>[19]\AgdaSymbol{:} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Tm} \<[19]%
\>[19]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Var} \<[19]%
\>[19]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_⇒\_} \<[19]%
\>[19]\AgdaSymbol{:} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{isContr} \<[19]%
\>[19]\AgdaSymbol{:} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>\<\end{code}
Contexts are inductively defined as either an empty context or
a context with a type in it.

\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Con} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ε} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaDatatype{Con}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{\_,\_} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Con}\<%
\\
\>\<\end{code}
Types are defined as either $*$ which we
call 0-cells, or a equality type between two terms of some type $A$. If the
type $A$ is an $n$-cell then we call its equality type an $(n+1)$-cell.

\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Ty} \AgdaBound{Γ} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{*} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{\_=h\_} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Γ}\<%
\\
\>\<\end{code}

\subsection{Heterogeneous Equality for Terms}\label{sec:het}

One of the big challenges we encountered was the difficulty to
formalise and reason about the equalities of terms, which is
essential when defining substitution. When the usual homogeneous identity types
are used one has to use substitution to unify
the types on both sides of equality types. This results in
$\mathit{subst}$ to appear in terms, about which one has to state
substitution lemmas. This further pollutes syntax requiring lemmas
about lemmas, lemmas about lemmas about lemmas, etc. For example, we
have to prove that using $\mathit{subst}$ consecutively with two equalities
of types is propositionally equal to using $\mathit{subst}$ with the
composition of these two equalities. As the complexity of the proofs
grows more lemmas are needed. The resulting
recurrence pattern has been identified and implemented in
\cite{txa:csl} for the special cases of coherence cells for
associativity, units and interchange. However it is not clear how that
approach could be adapted to the present, much more economical
formulation of {\wog}. Moreover, the complexity brings the
Agda type checker to its limits and correctness into question.

The idea of heterogenous equality (or JM equality) due to McBride
\cite{mcbride:elimination} used to resolve this issue is to define
equality for terms of different types, but its inhabitants only for
terms of definitionally equal types. However, the corresponding
elimination principle relies on UIP.  In \itt, UIP is not provable
in general, namely not all types are h-sets (homotopy
0-types). However every type with decidable equality is an h-set.
Inductive types with finitary constructors have decidable equality. In
our case, the types which stand for syntactic objects (contexts,
types, terms) are all inductive-inductive types with finitary
constructors. It follows by Hedberg's Theorem \cite{hed:98} that any
type with decidable equality satisfies UIP and it therefore follows
that the syntax staisfies UIP. Because, the equality of syntactic
types is unique, it is safe to use heterogeneous equality and proceed
without using substitution lemmas which would otherwise be necessary
to match terms of different types. From a computational perspective,
it means that every equality of types can be reduced to
$\mathit{refl}$ and using $\mathit{subst}$ to construct terms is
proof-irrelevant, which is expressed in the following definition of
heterogeneous equality for terms.


\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_≅\_} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{:}\<%
\\
\>[2]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{B} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{refl} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{b} \AgdaDatatype{≅} \AgdaBound{b}\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{\_-¹} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{b} \AgdaSymbol{→} \AgdaBound{b} \AgdaDatatype{≅} \AgdaBound{a}\<%
\\
\>\AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{\_)} \AgdaFunction{-¹} \<[13]%
\>[13]\AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaKeyword{infixr} \AgdaNumber{4} \_∾\_ \<%
\\
%
\\
\>\AgdaFunction{\_∾\_} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\{}\AgdaBound{A} \AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}\{}\AgdaBound{c} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{b} \AgdaSymbol{→} \<[14]%
\>[14]\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaBound{b} \AgdaDatatype{≅} \AgdaBound{c} \<[12]%
\>[12]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{c}\<%
\\
\>\AgdaFunction{\_∾\_} \AgdaSymbol{\{}c \AgdaSymbol{=} \AgdaBound{c}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{.}\AgdaBound{c}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{.}\AgdaBound{c}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaBound{c}\<%
\\
%
\\
\>\<\end{code}
}
Once we have heterogeneous equality for terms, we can define a proof-irrelevant substitution which we call coercion
since it gives us a term of type $A$ if we have a term of type $B$ and the
two types are equal. We can also prove that the coerced term is heterogeneously equal to the
original term. Combining these definitions, it is much
more convenient to formalise and reason about term equations.

\begin{code}\>\<%
\\
\>\AgdaFunction{\_⟦\_⟫} \<[12]%
\>[12]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{)} \<[46]%
\>[46]\<%
\\
\>[0]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{A}\<%
\\
\>\AgdaBound{a} \AgdaFunction{⟦} \AgdaInductiveConstructor{refl} \AgdaFunction{⟫} \<[12]%
\>[12]\AgdaSymbol{=} \AgdaBound{a}\<%
\\
%
\\
\>\AgdaFunction{cohOp} \<[12]%
\>[12]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \<[57]%
\>[57]\<%
\\
\>[0]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{⟦} \AgdaBound{p} \AgdaFunction{⟫} \AgdaDatatype{≅} \AgdaBound{a}\<%
\\
\>\AgdaFunction{cohOp} \AgdaInductiveConstructor{refl} \<[12]%
\>[12]\AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
\>\<\end{code}

% could delete the explanation of this lemma

%It is sufficient to prove the original terms are equal if we coerced them using the same proof. This lemma is useful later.

\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{cohOp-eq} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}\{}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{b}\AgdaSymbol{)} \<[66]%
\>[66]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{⟦} \AgdaBound{p} \AgdaFunction{⟫} \AgdaDatatype{≅} \AgdaBound{b} \AgdaFunction{⟦} \AgdaBound{p} \AgdaFunction{⟫}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{cohOp-eq} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{b}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{refl}\AgdaSymbol{\}} \AgdaBound{r} \AgdaSymbol{=} \AgdaBound{r}\<%
\\
%
\\
\>\AgdaFunction{cohOp-hom} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{⟦} \AgdaBound{p} \AgdaFunction{⟫} \AgdaInductiveConstructor{=h} \AgdaBound{b} \AgdaFunction{⟦} \AgdaBound{p} \AgdaFunction{⟫}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{cohOp-hom} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{cong≅} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}\{}\AgdaBound{D} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{C} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{D} \AgdaBound{C}\AgdaSymbol{))} \AgdaSymbol{→} \<[45]%
\>[45]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{b} \<[14]%
\>[14]\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaBound{f} \AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{f} \AgdaBound{b}\<%
\\
\>\AgdaFunction{cong≅} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{\_)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
%
\\
\>\<\end{code}
}


\subsection{Substitutions}

In this chapter we usually define a set of functions together and
we name a function $\mathsf{x}$ as $\mathsf{xC}$ for contexts, $\mathsf{xT}$ for types, $\mathsf{xV}$ for
variables $\mathsf{xtm}$ for terms and $\mathsf{xS}$ for context morphisms (substitutions). For example
the substitutions are declared as follows:

\begin{code}\>\<%
\\
\>\AgdaFunction{\_[\_]T} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{\_[\_]V} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Var} \AgdaBound{A} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{\_[\_]tm} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{A} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)} \<[59]%
\>[59]\<%
\\
\>\<\end{code}
Indeed, composition of context morphisms can be understood as substitution for context morphisms as well.

\begin{code}\>\<%
\\
\>\AgdaFunction{\_⊚\_} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Θ} \<[47]%
\>[47]\<%
\\
\>\<\end{code}
Context morphisms are defined inductively similarly to contexts. A context morphism is a list of terms corresponding to the list of types in the context on the right hand side of the morphism.

\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_⇒\_} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{•} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaInductiveConstructor{ε}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{\_,\_} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\<\end{code}

\subsection{Weakening}

We can freely add types to the contexts of any given type judgments,
term judgments or context morphisms. These are the weakening rules.

\begin{code}\>\>[2]\AgdaIndent{3}{}\<[3]%
\>[3]\<%
\\
\>\AgdaFunction{\_+T\_} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{\_+tm\_} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \<[52]%
\>[52]\<%
\\
\>\AgdaFunction{\_+S\_} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaBound{Δ} \<[53]%
\>[53]\<%
\\
\>\<\end{code}
%We could first define the weakening and substitution for types.
\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaInductiveConstructor{*} \<[9]%
\>[9]\AgdaFunction{+T} \AgdaBound{B} \AgdaSymbol{=} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)} \AgdaFunction{+T} \AgdaBound{B} \AgdaSymbol{=} \AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{B} \AgdaInductiveConstructor{=h} \AgdaBound{b} \AgdaFunction{+tm} \AgdaBound{B}\<%
\\
%
\\
%
\\
\>\AgdaInductiveConstructor{*} \<[9]%
\>[9]\AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T} \AgdaSymbol{=} \AgdaInductiveConstructor{*} \<[20]%
\>[20]\<%
\\
\>\AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T} \AgdaSymbol{=} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm} \AgdaInductiveConstructor{=h} \AgdaBound{b} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm}\<%
\\
%
\\
\>\<\end{code}
}

\subsection{Terms}

A term can be either a variable or a coherence constant ($\AgdaInductiveConstructor{coh}$).

We first define variables separately using the weakening rules. We
use typed de Bruijn indices to define variables as either the rightmost
variable of the context, or some variable in the context which can be
found by cancelling the rightmost variable along with each $\AgdaInductiveConstructor{vS}$.

\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Var} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{v0} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \<[35]%
\>[35]\AgdaSymbol{→} \AgdaDatatype{Var} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{vS} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Var} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\<\end{code}

The coherence constants are usually the most crucial in a definition of $wog$. In this syntactic approach, they are primitive terms of the primitive types in \emph{contractible contexts}
which will be introduced below. Indeed it encodes the fact that any type in a contractible context is inhabited, and so are the types generated by substituting into a contractible context.

\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Tm} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{var} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Var} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{A}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{coh} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \<[42]%
\>[42]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaFunction{cohOpV} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{\}(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaFunction{subst} \AgdaDatatype{Var} \AgdaBound{p} \AgdaBound{x}\AgdaSymbol{)} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaBound{x}\<%
\\
\>\AgdaFunction{cohOpV} \AgdaSymbol{\{}x \AgdaSymbol{=} \AgdaBound{x}\AgdaSymbol{\}} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{cohOpVs} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{\}(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{\{}B \AgdaSymbol{=} \AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{subst} \AgdaDatatype{Var} \AgdaBound{p} \AgdaBound{x}\AgdaSymbol{))} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{cohOpVs} \AgdaSymbol{\{}x \AgdaSymbol{=} \AgdaBound{x}\AgdaSymbol{\}} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{coh-eq} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{isc} \AgdaSymbol{:} \AgdaDatatype{isContr} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{γ} \AgdaDatatype{≡} \AgdaBound{δ} \AgdaSymbol{→} \AgdaInductiveConstructor{coh} \AgdaBound{isc} \AgdaBound{γ} \AgdaBound{A} \AgdaDatatype{≅} \AgdaInductiveConstructor{coh} \AgdaBound{isc} \AgdaBound{δ} \AgdaBound{A} \<[97]%
\>[97]\<%
\\
\>\AgdaFunction{coh-eq} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
%
\\
\>\<\end{code}
}

\subsection{Contractible contexts}
With variables defined, it is possible to formalise another core part of the syntactic framework, \emph{contractible
contexts}. Intuitively speaking, a context is contractible if its geometric
realization is contractible to a point. It either contains one
variable of the type $*$ which is the base case, or we can extend a contractible context with a
variable of an existing type and an $n$-cell, namely a morphism,
between the new variable and some existing variable. Contractibility
of contexts is defined as follows:

\begin{code}\>\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{isContr} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{c*} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaDatatype{isContr} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ext} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaBound{Γ} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{)} \<[50]%
\>[50]\<%
\\
\>[2]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \<[54]%
\>[54]\<%
\\
\>\<\end{code}

\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{hom≡} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{A'} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{a'} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A'}\AgdaSymbol{\}(}\AgdaBound{q} \AgdaSymbol{:} \AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{a'}\AgdaSymbol{)}\<%
\\
\>[7]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b'} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A'}\AgdaSymbol{\}(}\AgdaBound{r} \AgdaSymbol{:} \AgdaBound{b} \AgdaDatatype{≅} \AgdaBound{b'}\AgdaSymbol{)}\<%
\\
\>[7]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{a'} \AgdaInductiveConstructor{=h} \AgdaBound{b'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{hom≡} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{A'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{a'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{a'}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{.}\AgdaBound{a'}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{b'}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{b'}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{.}\AgdaBound{b'}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
%
\\
\>\AgdaFunction{S-eq} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[1]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T}\AgdaSymbol{)\}\{}\AgdaBound{a'} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}} \<[48]%
\>[48]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{γ} \AgdaDatatype{≡} \AgdaBound{δ} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{a'} \<[25]%
\>[25]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{\_≡\_} \AgdaSymbol{\{\_\}} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)\}} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a'}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{S-eq} \AgdaInductiveConstructor{refl} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{\_)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\<\end{code}
}


\subsection{Lemmas}

Since contexts, types, variables and
terms are all mutually defined, most of their properties have to
be proved simultaneously. Note that we are free to define all the
types first and all the definitions (not shown) later. 

The following lemmas are essential for the constructions and theorem
proving later.  The first set of lemmas states that to substitute a
type, a variable, a term, or a context morphism with two context
morphisms consecutively, is equivalent to substitute with the
composition of the two context morphisms:

\begin{code}\>\<%
\\
\>\AgdaFunction{[⊚]T} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{θ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}} \<[43]%
\>[43]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{θ} \AgdaFunction{⊚} \AgdaBound{δ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{θ} \AgdaFunction{]T}\AgdaSymbol{)}\AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T} \<[43]%
\>[43]\<%
\\
%
\\
\>\AgdaFunction{[⊚]v} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ} \AgdaBound{A}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{)\{}\AgdaBound{θ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{[} \AgdaBound{θ} \AgdaFunction{⊚} \AgdaBound{δ} \AgdaFunction{]V} \AgdaDatatype{≅} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{[} \AgdaBound{θ} \AgdaFunction{]V}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm}\<%
\\
%
\\
\>\AgdaFunction{[⊚]tm} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ} \AgdaBound{A}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)\{}\AgdaBound{θ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{θ} \AgdaFunction{⊚} \AgdaBound{δ} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{[} \AgdaBound{θ} \AgdaFunction{]tm}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm}\<%
\\
%
\\
\>\AgdaFunction{⊚assoc} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ} \AgdaBound{Ω}\AgdaSymbol{\}(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Θ} \AgdaDatatype{⇒} \AgdaBound{Ω}\AgdaSymbol{)\{}\AgdaBound{θ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{γ} \AgdaFunction{⊚} \AgdaBound{θ}\AgdaSymbol{)} \AgdaFunction{⊚} \AgdaBound{δ} \AgdaDatatype{≡} \AgdaBound{γ} \AgdaFunction{⊚} \AgdaSymbol{(}\AgdaBound{θ} \AgdaFunction{⊚} \AgdaBound{δ}\AgdaSymbol{)} \<[37]%
\>[37]\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaInductiveConstructor{•} \<[8]%
\>[8]\AgdaFunction{⊚} \AgdaBound{δ} \AgdaSymbol{=} \AgdaInductiveConstructor{•}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{⊚} \AgdaBound{δ'} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⊚} \AgdaBound{δ'}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ'} \AgdaFunction{]tm} \AgdaFunction{⟦} \AgdaFunction{[⊚]T} \AgdaFunction{⟫}\<%
\\
%
\\
\>\<\end{code}
}
The second set states that weakening inside substitution is equivalent to weakening outside:

\begin{code}\>\<%
\\
\>\AgdaFunction{[+S]T} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)} \AgdaFunction{+T} \AgdaBound{B} \<[42]%
\>[42]\<%
\\
%
\\
\>\AgdaFunction{[+S]tm} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm}\AgdaSymbol{)} \AgdaFunction{+tm} \AgdaBound{B}\<%
\\
%
\\
\>\AgdaFunction{[+S]S} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ} \AgdaBound{B}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{δ} \AgdaFunction{⊚} \AgdaSymbol{(}\AgdaBound{γ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⊚} \AgdaBound{γ}\AgdaSymbol{)} \AgdaFunction{+S} \AgdaBound{B}\<%
\\
\>\<\end{code}
%There are also some auxiliary functions derived from these lemmas. For instance, the function shown below is used a lot in proofs.
\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaFunction{wk-tm+} \<[12]%
\>[12]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \<[57]%
\>[57]\<%
\\
\>[8]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{wk-tm+} \AgdaBound{B} \AgdaBound{t} \<[12]%
\>[12]\AgdaSymbol{=} \AgdaBound{t} \AgdaFunction{⟦} \AgdaFunction{[+S]T} \AgdaFunction{⟫}\<%
\\
\>\<\end{code}
}
\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaInductiveConstructor{•} \<[8]%
\>[8]\AgdaFunction{+S} \AgdaBound{B} \AgdaSymbol{=} \AgdaInductiveConstructor{•}\<%
\\
\>\AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{+S} \AgdaBound{B} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{wk-tm+} \AgdaBound{B} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{[+S]T} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaInductiveConstructor{*}\AgdaSymbol{\}} \<[18]%
\>[18]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{[+S]T} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{[+S]tm} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{[+S]tm} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
}
We can cancel the last term in the substitution for weakened objects
since weakening doesn't introduce new variables in types and terms.

\begin{code}\>\<%
\\
\>\AgdaFunction{+T[,]T} \<[10]%
\>[10]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{B} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}} \<[53]%
\>[53]\<%
\\
\>[-6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{b} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\<%
\\
%
\\
\>\AgdaFunction{+tm[,]tm} \<[10]%
\>[10]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{c} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{B} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \<[23]%
\>[23]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{c} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm} \<[46]%
\>[46]\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \<[12]%
\>[12]\AgdaFunction{+tm} \AgdaBound{B} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaBound{cΔ} \AgdaBound{δ} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{+tm} \AgdaBound{B} \AgdaSymbol{=} \AgdaInductiveConstructor{coh} \AgdaBound{cΔ} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{)} \AgdaBound{A} \AgdaFunction{⟦} \AgdaFunction{sym} \AgdaFunction{[+S]T} \AgdaFunction{⟫} \<[53]%
\>[53]\<%
\\
%
\\
\>\AgdaFunction{cong+tm} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{→} \<[56]%
\>[56]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{b}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{C} \AgdaDatatype{≅} \AgdaBound{b} \AgdaFunction{+tm} \AgdaBound{C}\<%
\\
\>\AgdaFunction{cong+tm} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{\_)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{cong+tm2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{C} \AgdaDatatype{≅} \AgdaBound{a} \AgdaFunction{⟦} \AgdaBound{p} \AgdaFunction{⟫} \AgdaFunction{+tm} \AgdaBound{C}\<%
\\
\>\AgdaFunction{cong+tm2} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{wk-T} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{\{}\AgdaBound{A} \AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B} \AgdaSymbol{→} \AgdaBound{A} \AgdaFunction{+T} \AgdaBound{C} \AgdaDatatype{≡} \AgdaBound{B} \AgdaFunction{+T} \AgdaBound{C}\<%
\\
\>\AgdaFunction{wk-T} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{wk-tm} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{B} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}} \<[40]%
\>[40]\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{((}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{b} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{wk-tm} \AgdaBound{t} \AgdaSymbol{=} \AgdaBound{t} \AgdaFunction{⟦} \AgdaFunction{+T[,]T} \AgdaFunction{⟫}\<%
\\
%
\\
\>\AgdaInductiveConstructor{v0} \<[5]%
\>[5]\AgdaFunction{[} \AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaFunction{]V} \AgdaSymbol{=} \AgdaFunction{wk-tm} \AgdaBound{a}\<%
\\
\>\AgdaInductiveConstructor{vS} \AgdaBound{x} \AgdaFunction{[} \AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaFunction{]V} \AgdaSymbol{=} \AgdaFunction{wk-tm} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]V}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{wk-coh} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{B} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}} \<[40]%
\>[40]\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{t} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}} \<[29]%
\>[29]\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaFunction{wk-tm} \AgdaSymbol{\{}B \AgdaSymbol{=} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}b \AgdaSymbol{=} \AgdaBound{b}\AgdaSymbol{\}} \AgdaBound{t} \AgdaDatatype{≅} \AgdaBound{t}\<%
\\
\>\AgdaFunction{wk-coh} \AgdaSymbol{=} \AgdaFunction{cohOp} \AgdaFunction{+T[,]T}\<%
\\
%
\\
\>\AgdaFunction{wk-coh+} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \<[20]%
\>[20]\<%
\\
\>[7]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)\}}\<%
\\
\>[9]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaFunction{wk-tm+} \AgdaBound{B} \AgdaBound{x} \AgdaDatatype{≅} \AgdaBound{x}\<%
\\
\>\AgdaFunction{wk-coh+} \AgdaSymbol{=} \AgdaFunction{cohOp} \AgdaFunction{[+S]T}\<%
\\
%
\\
\>\AgdaFunction{wk-hom} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{B} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}} \<[40]%
\>[40]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{wk-tm} \AgdaSymbol{\{}B \AgdaSymbol{=} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}b \AgdaSymbol{=} \AgdaBound{b}\AgdaSymbol{\}} \AgdaBound{x} \AgdaInductiveConstructor{=h} \AgdaFunction{wk-tm} \AgdaSymbol{\{}B \AgdaSymbol{=} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}b \AgdaSymbol{=} \AgdaBound{b}\AgdaSymbol{\}} \AgdaBound{y}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{=h} \AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{wk-hom} \AgdaSymbol{=} \AgdaFunction{hom≡} \AgdaFunction{wk-coh} \AgdaFunction{wk-coh}\<%
\\
%
\\
%
\\
\>\AgdaFunction{wk-hom+} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{wk-tm+} \AgdaBound{B} \AgdaBound{x} \AgdaInductiveConstructor{=h} \AgdaFunction{wk-tm+} \AgdaBound{B} \AgdaBound{y}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{=h} \AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{wk-hom+} \AgdaSymbol{=} \AgdaFunction{hom≡} \AgdaFunction{wk-coh+} \AgdaFunction{wk-coh+}\<%
\\
%
\\
%
\\
\>\AgdaFunction{wk-⊚} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{\{}\AgdaBound{θ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Θ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{((}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{θ} \AgdaFunction{]T}\AgdaSymbol{)}\AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{θ} \AgdaFunction{⊚} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{wk-⊚} \AgdaBound{t} \AgdaSymbol{=} \AgdaBound{t} \AgdaFunction{⟦} \AgdaFunction{[⊚]T} \AgdaFunction{⟫}\<%
\\
%
\\
\>\AgdaFunction{[+S]S} \AgdaSymbol{\{}δ \AgdaSymbol{=} \AgdaInductiveConstructor{•}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{[+S]S} \AgdaSymbol{\{}δ \AgdaSymbol{=} \AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{S-eq} \AgdaFunction{[+S]S} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{[+S]tm} \AgdaBound{a} \AgdaFunction{∾} \AgdaFunction{cong+tm2} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{wk-coh+} \AgdaFunction{-¹}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{wk+S+T} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[7]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{γ}\AgdaSymbol{\}\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{→} \<[19]%
\>[19]\<%
\\
\>[7]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaBound{A} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{C} \<[23]%
\>[23]\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{+S} \AgdaBound{B} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{C} \AgdaFunction{+T} \AgdaBound{B}\<%
\\
\>\AgdaFunction{wk+S+T} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{[+S]T} \AgdaSymbol{(}\AgdaFunction{wk-T} \AgdaBound{eq}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{wk+S+tm} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)\{}\AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{c} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaBound{a} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{c} \<[24]%
\>[24]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{+S} \AgdaBound{B} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{c} \AgdaFunction{+tm} \AgdaBound{B}\<%
\\
\>\AgdaFunction{wk+S+tm} \AgdaSymbol{\_} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{[+S]tm} \AgdaSymbol{\_} \AgdaFunction{∾} \AgdaFunction{cong+tm} \AgdaBound{eq}\<%
\\
%
\\
%
\\
\>\AgdaFunction{wk+S+S} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Δ₁} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Δ₁}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{ω} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ₁}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaBound{δ} \AgdaFunction{⊚} \AgdaBound{γ} \AgdaDatatype{≡} \AgdaBound{ω}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaBound{δ} \AgdaFunction{⊚} \AgdaSymbol{(}\AgdaBound{γ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{ω} \AgdaFunction{+S} \AgdaBound{B}\<%
\\
\>\AgdaFunction{wk+S+S} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{[+S]S} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{+S} \AgdaSymbol{\_)} \AgdaBound{eq}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{[⊚]T} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaInductiveConstructor{*}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{[⊚]T} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{[⊚]tm} \AgdaSymbol{\_)} \AgdaSymbol{(}\AgdaFunction{[⊚]tm} \AgdaSymbol{\_)} \<[51]%
\>[51]\<%
\\
%
\\
\>\AgdaFunction{+T[,]T} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaInductiveConstructor{*}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{+T[,]T} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{hom≡} \<[34]%
\>[34]\AgdaSymbol{(}\AgdaFunction{+tm[,]tm} \AgdaSymbol{\_)} \AgdaSymbol{(}\AgdaFunction{+tm[,]tm} \AgdaSymbol{\_)}\<%
\\
%
\\
\>\<\end{code}
}
Most of the substitutions are defined as usual, except the one for coherence constants. In this case, we substitute in the context morphism part and one of the lemmas declared above is used.

\begin{code}\>\<%
\\
\>\AgdaInductiveConstructor{var} \AgdaBound{x} \<[12]%
\>[12]\AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm} \AgdaSymbol{=} \AgdaBound{x} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]V}\<%
\\
\>\AgdaInductiveConstructor{coh} \AgdaBound{cΔ} \AgdaBound{γ} \AgdaBound{A} \<[12]%
\>[12]\AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm} \AgdaSymbol{=} \AgdaInductiveConstructor{coh} \AgdaBound{cΔ} \AgdaSymbol{(}\AgdaBound{γ} \AgdaFunction{⊚} \AgdaBound{δ}\AgdaSymbol{)} \AgdaBound{A} \AgdaFunction{⟦} \AgdaFunction{sym} \AgdaFunction{[⊚]T} \AgdaFunction{⟫}\<%
\\
\>\<\end{code}


\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaComment{-- congruence}\<%
\\
%
\\
\>\AgdaFunction{congT} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B} \AgdaSymbol{→} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{B} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T} \<[75]%
\>[75]\<%
\\
\>\AgdaFunction{congT} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
%
\\
\>\AgdaFunction{congT2} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{δ} \AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{δ} \AgdaDatatype{≡} \AgdaBound{γ} \AgdaSymbol{→} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T}\<%
\\
\>\AgdaFunction{congT2} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \<[19]%
\>[19]\<%
\\
%
\\
\>\AgdaFunction{congV} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaInductiveConstructor{var} \AgdaBound{a} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaBound{b} \AgdaSymbol{→} \<[21]%
\>[21]\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}} \<[17]%
\>[17]\<%
\\
\>[0]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]V} \AgdaDatatype{≅} \AgdaBound{b} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]V}\<%
\\
\>\AgdaFunction{congV} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{b}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{b}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{.(}\AgdaInductiveConstructor{var} \AgdaBound{b}\AgdaSymbol{)}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{congtm} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}}\<%
\\
\>[5]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{→} \<[20]%
\>[20]\<%
\\
\>[5]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[5]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{b} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm}\<%
\\
\>\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{\_)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_} \<[25]%
\>[25]\<%
\\
%
\\
\>\AgdaFunction{congtm2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{δ} \AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{δ} \AgdaDatatype{≡} \AgdaBound{γ}\AgdaSymbol{)}\<%
\\
\>[-4]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]tm}\<%
\\
\>\AgdaFunction{congtm2} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{⊚assoc} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{⊚assoc} \AgdaSymbol{(}\AgdaInductiveConstructor{\_,\_} \AgdaBound{γ} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{S-eq} \AgdaSymbol{(}\AgdaFunction{⊚assoc} \AgdaBound{γ}\AgdaSymbol{)} \<[39]%
\>[39]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \<[16]%
\>[16]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[⊚]T}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∾} \AgdaSymbol{((}\AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \<[19]%
\>[19]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∾} \AgdaFunction{[⊚]tm} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{-¹}\AgdaSymbol{)))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{[⊚]v} \AgdaSymbol{(}\AgdaInductiveConstructor{v0} \AgdaSymbol{\{}\AgdaBound{Γ₁}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\})} \AgdaSymbol{\{}\AgdaBound{θ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{\}} \<[28]%
\>[28]\AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \AgdaFunction{∾} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{+T[,]T} \AgdaFunction{-¹}\AgdaSymbol{)} \<[77]%
\>[77]\<%
\\
\>\AgdaFunction{[⊚]v} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{\{}\AgdaBound{Γ₁}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{θ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{=} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{[⊚]v} \AgdaBound{x} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{+T[,]T}\AgdaSymbol{)} \AgdaFunction{-¹}\AgdaSymbol{))}\<%
\\
%
\\
%
\\
%
\\
\>\AgdaFunction{[⊚]tm} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{[⊚]v} \AgdaBound{x}\<%
\\
\>\AgdaFunction{[⊚]tm} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaBound{c} \AgdaBound{γ} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{coh-eq} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{⊚assoc} \AgdaBound{γ}\AgdaSymbol{))} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaFunction{-¹}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaFunction{-¹}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{⊚wk} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Δ₁}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Δ₁}\AgdaSymbol{)\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{c} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{B} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{γ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{⊚} \AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{c}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{γ} \AgdaFunction{⊚} \AgdaBound{δ}\<%
\\
\>\AgdaFunction{⊚wk} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{⊚wk} \AgdaSymbol{(}\AgdaInductiveConstructor{\_,\_} \AgdaBound{γ} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{S-eq} \AgdaSymbol{(}\AgdaFunction{⊚wk} \AgdaBound{γ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[+S]T}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{+tm[,]tm} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \AgdaFunction{-¹}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{+tm[,]tm} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{cohOp} \AgdaFunction{+T[,]T}\<%
\\
\>\AgdaFunction{+tm[,]tm} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaBound{x} \AgdaBound{γ} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[+S]T}\AgdaSymbol{))} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{coh-eq} \AgdaSymbol{(}\AgdaFunction{⊚wk} \AgdaBound{γ}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaFunction{-¹}\<%
\\
%
\\
%
\\
%
\\
\>\AgdaFunction{[+S]V} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{)\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B} \AgdaFunction{]V} \AgdaDatatype{≅} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]V}\AgdaSymbol{)} \AgdaFunction{+tm} \AgdaBound{B}\<%
\\
\>\AgdaFunction{[+S]V} \AgdaInductiveConstructor{v0} \AgdaSymbol{\{}\AgdaInductiveConstructor{\_,\_} \AgdaBound{δ} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{wk-coh+} \AgdaFunction{∾} \AgdaFunction{cong+tm2} \AgdaFunction{+T[,]T}\<%
\\
\>\AgdaFunction{[+S]V} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{[+S]V} \AgdaBound{x} \AgdaFunction{∾} \AgdaFunction{cong+tm2} \AgdaFunction{+T[,]T}\<%
\\
%
\\
%
\\
\>\AgdaFunction{[+S]tm} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{[+S]V} \AgdaBound{x}\<%
\\
\>\AgdaFunction{[+S]tm} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaBound{x} \AgdaBound{δ} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{coh-eq} \AgdaFunction{[+S]S} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[+S]T}\AgdaSymbol{)} \AgdaFunction{-¹} \AgdaFunction{∾} \AgdaFunction{cong+tm2} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaComment{-- some widely-used contexts}\<%
\\
%
\\
\>\AgdaFunction{x:*} \AgdaSymbol{:} \AgdaDatatype{Con}\<%
\\
\>\AgdaFunction{x:*} \AgdaSymbol{=} \AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\<%
\\
%
\\
\>\AgdaFunction{x:*,y:*,α:x=y} \AgdaSymbol{:} \AgdaDatatype{Con}\<%
\\
\>\AgdaFunction{x:*,y:*,α:x=y} \AgdaSymbol{=} \AgdaFunction{x:*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{vX} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y}\AgdaSymbol{\}} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaFunction{vX} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{vY} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y}\AgdaSymbol{\}} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaFunction{vY} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{vα} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{vX} \AgdaInductiveConstructor{=h} \AgdaFunction{vY}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{vα} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
%
\\
\>\AgdaFunction{x:*,y:*,α:x=y,z:*,β:y=z} \AgdaSymbol{:} \AgdaDatatype{Con}\<%
\\
\>\AgdaFunction{x:*,y:*,α:x=y,z:*,β:y=z} \AgdaSymbol{=} \AgdaFunction{x:*,y:*,α:x=y} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{vZ} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y,z:*,β:y=z}\AgdaSymbol{\}} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaFunction{vZ} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{vβ} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y,z:*,β:y=z}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{vY} \AgdaFunction{+tm} \AgdaSymbol{\_} \AgdaFunction{+tm} \AgdaSymbol{\_} \AgdaInductiveConstructor{=h} \AgdaFunction{vZ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{vβ} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
%
\\
\>\<\end{code}
}


\section{Some Important Derivable Constructions}

%\input{IdentityContextMorphisms}


\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaKeyword{module} \AgdaModule{IdentityContextMorphisms} \AgdaKeyword{where}\<%
\\
%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{BasicSyntax}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \<[50]%
\>[50]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}\_,\_ \AgdaSymbol{to} \_,,\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat}\<%
\\
%
\\
\>\<\end{code}
}


In this section we show how to reconstruct the structure
of a (weak) $\omega$-groupoid from the syntactical framework presented
in \autoref{sec:syntax} in the more explicit style of \cite{txa:csl}. To 
this end, let us call a term $a : \Tm~\AgdaBound{A}$ an $n$-cell if
$\AgdaFunction{level}~\AgdaBound{A}~ \AgdaSymbol{\equiv}~ \AgdaBound{n}$, where 

\begin{code}\>\<%
\\
\>\AgdaFunction{level} \<[22]%
\>[22]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Γ} \AgdaSymbol{→} \AgdaDatatype{ℕ}\<%
\\
\>\AgdaFunction{level} \AgdaInductiveConstructor{*} \<[22]%
\>[22]\AgdaSymbol{=} \AgdaNumber{0}\<%
\\
\>\AgdaFunction{level} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\_} \AgdaSymbol{\_)} \<[22]%
\>[22]\AgdaSymbol{=} \AgdaInductiveConstructor{suc} \AgdaSymbol{(}\AgdaFunction{level} \AgdaBound{A}\AgdaSymbol{)} \<[38]%
\>[38]\<%
\\
\>\<\end{code}
%
In any $\omega$-category, any $n$-cell $a$ has a  domain (source), $s^n_m\,a$, and
a codomain (target), $t^n_m\,a$, for each $m \le n$. These are, of
course, $(n \text{-} m)$-cells. For each pair of $n$-cells such that for some
$m$, $s^n_m a \equiv t^n_m b$, there must exist their composition
${a \circ^n_m b}$ which is an $n$-cell. Composition is (weakly)
associative. Moreover for any $(n \text{-} m)$-cell $\AgdaBound{x}$ there
exists an $n$-cell $\mathsf{id}^n_m\,\AgdaBound{x}$ which
behaves like a (weak) identity with respect to $\circ^n_m$.
For the time being we discuss only the construction of cells and omit
the question of coherence. 

For instance, in the simple case of bicategories, each $2$-cell $a$ has a
horizontal source $s^1_1\,a$ and target $t^1_1\,a$, and also a vertical source
$s^2_1\,a$ and target $t^2_1 a$,
which is also the source and target, of the horizontal source and target,
respectively, of $a$. There is horizontal composition of $1$-cells $\circ^1_1$: $x
\to^f y \to^g z$, and also horizontal composition of $2$-cells
$\circ^2_1$, and vertical composition of $2$-cells $\circ^2_2$. There
is a horizontal identity on $a$, $\mathsf{id}^1_1\,a$, and vertical
identity on $a$, $\mathsf{id}^2_1\,a =
\mathsf{id}^2_2\mathsf{id}^1_1\,a$. 

Thus each $\omega$-groupoid construction is defined with respect to a
\emph{level}, $m$, and depth $n \text{-} m$ and the structure of
an $\omega$-groupoid is repeated on each level. As we are working purely syntactically we
may make use of this fact and define all groupoid structure only at level
$m=1$ and provide a so-called \emph{replacement operation} which allows us to lift
any cell to an arbitrary type $A$. It is called 'replacement' because
we are syntactically replacing the base type $*$ with an arbitrary
type, $A$.

An important general mechanism we rely on throughout the development
follows directly from the type of the only nontrivial constructor of $\Tm$,
$\mathsf{coh}$, which tells us that to construct a
new term of type $\Gamma \vdash A$, we need a contractible context,
$\Delta$, a type $\Delta\vdash T$ and a context morphism $\delta :
\Gamma \Rightarrow \Delta$ such that
%
\[
\AgdaBound{T} \,\AgdaFunction{[}\, \AgdaBound{δ}\,
\AgdaFunction{]T}~\AgdaDatatype{≡}~\AgdaBound{A}
\]
%
Because in a contractible context all types are inhabited we may in a
way work freely in $\Delta$ and then pull back all terms to $A$ using
$\delta$. 
To show this formally, we must first define identity context morphisms
which complete the definition of a \emph{category} of contexts and
context morphisms:

\begin{code}\>\<%
\\
\>\AgdaFunction{IdS} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Γ}\<%
\\
\>\<\end{code}
It satisfies the following property:

\begin{code}\>\<%
\\
\>\AgdaFunction{IC-T} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{A} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A}\<%
\\
\>\<\end{code}
The definition proceeds by structural recursion and therefore extends
to terms, variables and context morphisms with analogous properties. 
It allows us to define at once:

\begin{code}\>\<%
\\
\>\AgdaFunction{Coh-Contr} \<[15]%
\>[15]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaBound{Γ} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{A}\<%
\\
\>\AgdaFunction{Coh-Contr} \AgdaBound{isC} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaInductiveConstructor{coh} \AgdaBound{isC} \AgdaFunction{IdS} \AgdaSymbol{\_} \AgdaFunction{⟦} \AgdaFunction{sym} \AgdaFunction{IC-T} \AgdaFunction{⟫}\<%
\\
\>\<\end{code}
We use $\AgdaFunction{Coh-Contr}$ as follows: for each kind of cell we
want to define, we construct a minimal contractible context built out
of variables together with a context morphism that populates the
context with terms and a lemma that states an equality
between the substitution and the original type.

\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaFunction{IC-v} \<[6]%
\>[6]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaFunction{]V} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaBound{x}\<%
\\
\>\AgdaFunction{IC-S} \<[6]%
\>[6]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \<[39]%
\>[39]\AgdaSymbol{→} \AgdaBound{δ} \AgdaFunction{⊚} \AgdaFunction{IdS} \AgdaDatatype{≡} \AgdaBound{δ}\<%
\\
\>\AgdaFunction{IC-tm} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{a}\<%
\\
%
\\
\>\AgdaFunction{IdS} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaInductiveConstructor{•}\<%
\\
\>\AgdaFunction{IdS} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{IdS} \AgdaFunction{+S} \AgdaSymbol{\_} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{⟦} \AgdaFunction{wk+S+T} \AgdaFunction{IC-T} \AgdaFunction{⟫}\<%
\\
%
\\
\>\AgdaFunction{IC-T} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{*}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{IC-T} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{IC-tm} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{IC-tm} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{IC-v} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{v0} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\})} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{wk+S+T} \AgdaFunction{IC-T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{IC-v} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{wk+S+tm} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{IC-v} \AgdaSymbol{\_)}\<%
\\
%
\\
\>\AgdaFunction{IC-S} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{IC-S} \AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{S-eq} \AgdaSymbol{(}\AgdaFunction{IC-S} \AgdaBound{δ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \AgdaFunction{∾} \AgdaFunction{IC-tm} \AgdaBound{a}\AgdaSymbol{)} \<[52]%
\>[52]\<%
\\
%
\\
\>\AgdaFunction{IC-tm} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{IC-v} \AgdaBound{x}\<%
\\
\>\AgdaFunction{IC-tm} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaBound{x} \AgdaBound{δ} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{coh-eq} \AgdaSymbol{(}\AgdaFunction{IC-S} \AgdaBound{δ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{pr1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{pr2} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaFunction{pr1} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{pr1-wk-T} \<[10]%
\>[10]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{A} \AgdaFunction{[} \AgdaFunction{pr1} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\<%
\\
\>\AgdaFunction{pr1-wk-tm} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}} \<[45]%
\>[45]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{[} \AgdaFunction{pr1} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{B}\<%
\\
\>\AgdaFunction{pr1-wk-S} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \<[47]%
\>[47]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{δ} \AgdaFunction{⊚} \AgdaSymbol{(}\AgdaFunction{pr1} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\})} \AgdaDatatype{≡} \AgdaBound{δ} \AgdaFunction{+S} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{pr2-v0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{pr2} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
%
\\
\>\AgdaFunction{pr-beta} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{pr1} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaInductiveConstructor{,} \AgdaFunction{pr2}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{IdS}\<%
\\
%
\\
\>\AgdaFunction{pr1} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{IdS} \AgdaFunction{+S} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{pr1-wk-T} \AgdaSymbol{=} \AgdaFunction{wk+S+T} \AgdaFunction{IC-T}\<%
\\
%
\\
\>\AgdaFunction{pr1-wk-tm} \AgdaSymbol{\{}a \AgdaSymbol{=} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{wk+S+tm} \AgdaBound{a} \AgdaSymbol{(}\AgdaFunction{IC-tm} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{pr1-wk-S} \AgdaBound{δ} \AgdaSymbol{=} \AgdaFunction{wk+S+S} \AgdaSymbol{(}\AgdaFunction{IC-S} \AgdaSymbol{\_)}\<%
\\
%
\\
\>\AgdaFunction{pr2} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{⟦} \AgdaFunction{wk+S+T} \AgdaFunction{IC-T} \AgdaFunction{⟫}\<%
\\
%
\\
\>\AgdaFunction{pr2-v0} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{[+S]T} \AgdaSymbol{(}\AgdaFunction{wk-T} \AgdaFunction{IC-T}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{pr-beta} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{IsId} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{isId-bsc} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaInductiveConstructor{ε} \AgdaDatatype{⇒} \AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{IsId} \AgdaBound{γ}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{isId-ind} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{IsId} \AgdaBound{γ} \AgdaSymbol{→} \<[47]%
\>[47]\<%
\\
\>[2]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[36]%
\>[36]\<%
\\
\>[2]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{eq} \AgdaSymbol{:} \AgdaBound{B} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A}\AgdaSymbol{)} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{→} \AgdaDatatype{IsId} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{γ} \AgdaFunction{+S} \AgdaSymbol{\_} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{⟦} \AgdaFunction{wk+S+T} \AgdaBound{eq} \AgdaFunction{⟫}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{IC-IsId} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{IsId} \AgdaSymbol{(}\AgdaFunction{IdS} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\})}\<%
\\
\>\AgdaFunction{IC-IsId} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaInductiveConstructor{isId-bsc}\<%
\\
\>\AgdaFunction{IC-IsId} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaInductiveConstructor{isId-ind} \AgdaSymbol{(}\AgdaFunction{IC-IsId} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\})} \AgdaFunction{IC-T}\<%
\\
%
\\
%
\\
\>\AgdaFunction{IC-tm'-v0} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)\}} \AgdaSymbol{→} \AgdaDatatype{IsId} \AgdaBound{γ} \AgdaSymbol{→} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
\>\AgdaFunction{IC-tm'-v0} \AgdaSymbol{(}\AgdaInductiveConstructor{isId-ind} \AgdaBound{isd} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{[+S]T} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{Id-with} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \<[22]%
\>[22]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Id-with} \AgdaBound{x} \AgdaSymbol{=} \AgdaFunction{IdS} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{⟦} \AgdaFunction{IC-T} \AgdaFunction{⟫}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{apply-S''} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{B} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{apply-S''} \AgdaBound{x} \AgdaBound{γ} \AgdaBound{p} \AgdaSymbol{=} \AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{⟦} \AgdaBound{p} \AgdaFunction{⟫}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{apply''} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{B} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A}\AgdaSymbol{)\{}\AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{C}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{C} \AgdaFunction{[} \AgdaFunction{apply-S''} \AgdaBound{x} \AgdaBound{γ} \AgdaBound{p} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{apply''} \AgdaBound{x} \AgdaBound{γ} \AgdaBound{p} \AgdaBound{f} \AgdaSymbol{=} \AgdaBound{f} \AgdaFunction{[} \AgdaFunction{apply-S''} \AgdaBound{x} \AgdaBound{γ} \AgdaBound{p} \AgdaFunction{]tm}\<%
\\
%
\\
\>\AgdaFunction{apply-x} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}} \<[21]%
\>[21]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{[} \AgdaFunction{Id-with} \AgdaBound{x} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{x}\<%
\\
\>\AgdaFunction{apply-x} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{IC-T}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{apply-id} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}(}\AgdaBound{y} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaFunction{+tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{Id-with} \AgdaBound{x} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{y}\<%
\\
\>\AgdaFunction{apply-id} \AgdaBound{y} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{+tm[,]tm} \AgdaBound{y}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{IC-tm} \AgdaSymbol{\_)}\<%
\\
%
\\
\>\AgdaFunction{apply-T} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \<[21]%
\>[21]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{apply-T} \AgdaBound{B} \AgdaBound{x} \AgdaSymbol{=} \AgdaBound{B} \AgdaFunction{[} \AgdaFunction{Id-with} \AgdaBound{x} \AgdaFunction{]T}\<%
\\
%
\\
%
\\
\>\AgdaFunction{apply} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \<[19]%
\>[19]\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{apply-T} \AgdaBound{B} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{apply} \AgdaBound{t} \AgdaBound{x} \AgdaSymbol{=} \AgdaBound{t} \AgdaFunction{[} \AgdaFunction{Id-with} \AgdaBound{x} \AgdaFunction{]tm}\<%
\\
%
\\
\>\AgdaFunction{apply-2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{C}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{y} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{apply-T} \AgdaSymbol{(}\AgdaFunction{apply-T} \AgdaBound{C} \AgdaBound{y}\AgdaSymbol{)} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{apply-2} \AgdaBound{f} \AgdaBound{x} \AgdaBound{y} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{f} \AgdaFunction{[} \<[22]%
\>[22]\AgdaFunction{Id-with} \AgdaBound{y} \AgdaFunction{]tm}\AgdaSymbol{)} \AgdaFunction{[} \<[40]%
\>[40]\AgdaFunction{Id-with} \AgdaBound{x} \AgdaFunction{]tm}\<%
\\
%
\\
\>\AgdaFunction{apply-3} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{D} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{B} \AgdaInductiveConstructor{,} \AgdaBound{C}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{B} \AgdaInductiveConstructor{,} \AgdaBound{C}\AgdaSymbol{\}} \AgdaBound{D}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{y} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{)(}\AgdaBound{z} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{C}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \<[12]%
\>[12]\AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{apply-T} \AgdaSymbol{(}\AgdaFunction{apply-T} \AgdaSymbol{(}\AgdaFunction{apply-T} \AgdaBound{D} \AgdaBound{z}\AgdaSymbol{)} \AgdaBound{y}\AgdaSymbol{)} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{apply-3} \AgdaBound{f} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{=} \AgdaSymbol{((}\AgdaBound{f} \AgdaFunction{[} \<[25]%
\>[25]\AgdaFunction{Id-with} \AgdaBound{z} \AgdaFunction{]tm}\AgdaSymbol{)} \AgdaFunction{[} \<[43]%
\>[43]\AgdaFunction{Id-with} \AgdaBound{y} \AgdaFunction{]tm}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{Id-with} \AgdaBound{x} \AgdaFunction{]tm}\<%
\\
%
\\
\>\AgdaFunction{fun} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[30]%
\>[30]\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{B} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaBound{B}\AgdaSymbol{)} \<[28]%
\>[28]\<%
\\
\>\AgdaFunction{fun} \AgdaBound{t} \AgdaBound{a} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{t} \AgdaFunction{[} \AgdaFunction{Id-with} \AgdaBound{a} \AgdaFunction{]tm}\AgdaSymbol{)} \AgdaFunction{⟦} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{+T[,]T} \AgdaFunction{IC-T}\AgdaSymbol{)} \AgdaFunction{⟫}\<%
\\
%
\\
%
\\
\>\<\end{code}

}



%\input{Suspension}



\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaSymbol{\{-\#} \AgdaKeyword{OPTIONS} --type-in-type --no-positivity-check --no-termination-check \AgdaSymbol{\#-\}}\<%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{Suspension} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{BasicSyntax}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{IdentityContextMorphisms}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \<[50]%
\>[50]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}\_,\_ \AgdaSymbol{to} \_,,\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Empty}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat}\<%
\\
%
\\
%
\\
\>\AgdaFunction{1-1S-same} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[36]%
\>[36]\<%
\\
\>[0]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaBound{B} \AgdaDatatype{≡} \AgdaBound{A} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{1-1S-same} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{pr1} \AgdaInductiveConstructor{,} \AgdaFunction{pr2} \AgdaFunction{⟦} \AgdaFunction{congT} \AgdaBound{eq} \AgdaFunction{⟫} \<[38]%
\>[38]\<%
\\
%
\\
%
\\
\>\AgdaFunction{1-1S-same-T} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[38]%
\>[38]\<%
\\
\>[12]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{(}\AgdaBound{eq} \AgdaSymbol{:} \AgdaBound{B} \AgdaDatatype{≡} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{1-1S-same} \AgdaBound{eq} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\<%
\\
\>\AgdaFunction{1-1S-same-T} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{+T[,]T} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{[+S]T} \AgdaSymbol{(}\AgdaFunction{wk-T} \AgdaFunction{IC-T}\AgdaSymbol{))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{1-1S-same-tm} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[49]%
\>[49]\<%
\\
\>[12]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{(}\AgdaBound{eq} \AgdaSymbol{:} \AgdaBound{B} \AgdaDatatype{≡} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{1-1S-same} \AgdaBound{eq} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{1-1S-same-tm} \AgdaBound{eq} \AgdaBound{a} \AgdaSymbol{=} \AgdaFunction{+tm[,]tm} \AgdaBound{a} \AgdaFunction{∾} \AgdaFunction{[+S]tm} \AgdaBound{a} \AgdaFunction{∾} \AgdaFunction{cong+tm} \AgdaSymbol{(}\AgdaFunction{IC-tm} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{1-1S-same-v0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \<[41]%
\>[41]\<%
\\
\>[12]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{(}\AgdaBound{eq} \AgdaSymbol{:} \AgdaBound{B} \AgdaDatatype{≡} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{[} \AgdaFunction{1-1S-same} \AgdaBound{eq} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
\>\AgdaFunction{1-1S-same-v0} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaBound{eq}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{pr2-v0}\<%
\\
%
\\
%
\\
\>\AgdaFunction{\_++\_} \AgdaSymbol{:} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaDatatype{Con}\<%
\\
%
\\
\>\AgdaFunction{cor} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{++} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaBound{Δ}\<%
\\
%
\\
\>\AgdaFunction{repeat-p1} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{++} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaBound{Γ}\<%
\\
%
\\
\>\AgdaBound{Γ} \AgdaFunction{++} \AgdaInductiveConstructor{ε} \AgdaSymbol{=} \AgdaBound{Γ}\<%
\\
\>\AgdaBound{Γ} \AgdaFunction{++} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{Γ} \AgdaFunction{++} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaFunction{[} \AgdaFunction{cor} \AgdaBound{Δ} \AgdaFunction{]T}\<%
\\
%
\\
%
\\
\>\AgdaFunction{repeat-p1} \AgdaInductiveConstructor{ε} \AgdaSymbol{=} \AgdaFunction{IdS}\<%
\\
\>\AgdaFunction{repeat-p1} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{repeat-p1} \AgdaBound{Δ} \AgdaFunction{⊚} \AgdaFunction{pr1}\<%
\\
%
\\
%
\\
\>\AgdaFunction{cor} \AgdaInductiveConstructor{ε} \AgdaSymbol{=} \AgdaInductiveConstructor{•}\<%
\\
\>\AgdaFunction{cor} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{cor} \AgdaBound{Δ} \AgdaFunction{+S} \AgdaSymbol{\_)} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{⟦} \AgdaFunction{[+S]T} \AgdaFunction{⟫}\<%
\\
%
\\
%
\\
%
\\
\>\AgdaFunction{\_++S\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Θ} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaFunction{++} \AgdaBound{Θ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{cor-inv} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{cor} \AgdaBound{Θ} \AgdaFunction{⊚} \AgdaSymbol{(}\AgdaBound{γ} \AgdaFunction{++S} \AgdaBound{δ}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{δ}\<%
\\
%
\\
\>\AgdaBound{γ} \AgdaFunction{++S} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaBound{γ}\<%
\\
\>\AgdaBound{γ} \AgdaFunction{++S} \AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{γ} \AgdaFunction{++S} \AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaFunction{⟦} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{congT2} \AgdaSymbol{(}\AgdaFunction{cor-inv} \AgdaSymbol{\_))} \AgdaFunction{⟫} \<[70]%
\>[70]\<%
\\
%
\\
\>\AgdaFunction{cor-inv} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{cor-inv} \AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{S-eq} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{⊚wk} \AgdaSymbol{\_)} \AgdaSymbol{(}\AgdaFunction{cor-inv} \AgdaBound{δ}\AgdaSymbol{))} \<[51]%
\>[51]\<%
\\
\>[-5]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \AgdaFunction{∾} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[+S]T}\AgdaSymbol{)} \<[43]%
\>[43]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaFunction{+T[,]T} \<[23]%
\>[23]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{congT2} \AgdaSymbol{(}\AgdaFunction{cor-inv} \AgdaSymbol{\_))))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{id-S++} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaBound{Θ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{++} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaFunction{++} \AgdaBound{Θ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{id-S++} \AgdaBound{Δ} \AgdaBound{Θ} \AgdaBound{γ} \AgdaSymbol{=} \AgdaFunction{repeat-p1} \AgdaBound{Δ} \AgdaFunction{++S} \AgdaSymbol{(}\AgdaBound{γ} \AgdaFunction{⊚} \AgdaFunction{cor} \AgdaSymbol{\_)}\<%
\\
%
\\
\>\<\end{code}
}


\subsection{Suspension and Replacement}
\label{sec:susp-and-repl}
%
For an arbitrary type $A$ in $\Gamma$ of level $n$ one can
define a context with $2n$
variables, called the \emph{stalk} of $A$. Moreover one can
define a morphism from $\Gamma$ to the stalk of $A$ such that its
substitution into the maximal type in the stalk of $A$ gives back
$A$. The stalk of $A$ depends only on the level of $A$, the terms in
$A$ define the substitution. Here is an example of stalks of small
levels: $\varepsilon$ (the empty context) for $n=0$; $(x_0 : *, x_1 : *)$ for
$n=1$; $(x_0 : *, x_1 : *, x_2 : x_0\,=_\mathsf{h}\,x_1, x_3 :
x_0\,=_\mathsf{h}\,x_1)$ for $n=2$, etc. 
% \[
% \begin{array}{c@{\hspace{1.5cm}} c@{\hspace{1.5cm}} c@{\hspace{1.5cm}} c@{\hspace{1.5cm}} c@{\hspace{1.5cm}}}
% &&&&6\quad 7\\
% &&&4\quad 5&4 \quad 5\\
% &&2\quad 3&2\quad 3&2\quad 3\\
% &0\quad 1&0\quad 1&0\quad 1&0\quad 1\\
% \\
% n = 0 & n = 1 & n = 2 & n = 3 & n = 4 
% \end{array}
% \]

This is the $\Delta = \varepsilon$ case of a more general construction
where in we \emph{suspend} an arbitrary context $\Delta$ by adding $2n$
variables to the beginning of it, and weakening the rest of the
variables appropriately so that type $*$ becomes $x_{2n-2} =_\mathsf{h}
x_{2n-1}$. A crucial property of suspension is that it preserves
contractibility. 


\subsubsection{Suspension}
\label{sec:susp}

\emph{Suspension} is defined by iteration level-$A$-times the following
operation of one-level suspension. \AgdaFunction{ΣC} takes a
context and gives a context with two new variables of type $*$ added
at the beginning, and with all remaining types in the context suspended
by one level. 

\begin{code}\>\<%
\\
\>\AgdaFunction{ΣC} \AgdaSymbol{:} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaDatatype{Con}\<%
\\
\>\AgdaFunction{ΣT} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Γ} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaFunction{ΣC} \AgdaBound{Γ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{ΣC} \AgdaInductiveConstructor{ε} \<[12]%
\>[12]\AgdaSymbol{=} \AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaFunction{ΣC} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \<[12]%
\>[12]\AgdaSymbol{=} \AgdaFunction{ΣC} \AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaFunction{ΣT} \AgdaBound{A}\<%
\\
\>\<\end{code}
\noindent The rest of the definitions is straightforward by structural
recursion. In particular we suspend variables, terms and context morphisms:

\begin{code}\>\<%
\\
\>\AgdaFunction{Σv} \<[5]%
\>[5]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Var} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Var} \AgdaSymbol{(}\AgdaFunction{ΣT} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Σtm} \<[5]%
\>[5]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{ΣT} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Σs} \<[5]%
\>[5]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaFunction{ΣC} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaFunction{ΣC} \AgdaBound{Δ}\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaFunction{*'} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaFunction{ΣC} \AgdaBound{Γ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{*'} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
\>\AgdaFunction{*'} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{*'} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaFunction{+T} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{ΣT} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaInductiveConstructor{*} \AgdaSymbol{=} \AgdaFunction{*'} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>\AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{Σtm} \AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaFunction{Σtm} \AgdaBound{b}\<%
\\
%
\\
\>\AgdaFunction{Σs•} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{ΣC} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaFunction{ΣC} \AgdaInductiveConstructor{ε}\<%
\\
\>\AgdaFunction{Σs•} \AgdaInductiveConstructor{ε} \AgdaSymbol{=} \AgdaFunction{IdS}\<%
\\
\>\AgdaFunction{Σs•} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{Σs•} \AgdaBound{Γ} \AgdaFunction{+S} \AgdaSymbol{\_}\<%
\\
%
\\
\>\<\end{code}
}
\noindent The following lemma establishes preservation of contractibility by
one-step suspension:

\begin{code}\>\<%
\\
\>\AgdaFunction{ΣC-Contr} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaSymbol{(}\AgdaFunction{ΣC} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
\noindent It is also essential that suspension respects weakening and substitution:

\begin{code}\>\<%
\\
\>\AgdaFunction{ΣT[+T]} \<[9]%
\>[9]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \<[28]%
\>[28]\<%
\\
\>[8]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{ΣT} \AgdaBound{A} \AgdaFunction{+T} \AgdaFunction{ΣT} \AgdaBound{B}\<%
\\
%
\\
\>\AgdaFunction{Σtm[+tm]} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \<[38]%
\>[38]\<%
\\
\>[8]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaFunction{Σtm} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{≅} \AgdaFunction{Σtm} \AgdaBound{a} \AgdaFunction{+tm} \AgdaFunction{ΣT} \AgdaBound{B}\<%
\\
%
\\
\>\AgdaFunction{ΣT[Σs]T} \<[9]%
\>[9]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \<[39]%
\>[39]\<%
\\
\>[8]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{ΣT} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{Σs} \AgdaBound{δ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaFunction{ΣT[+T]} \AgdaInductiveConstructor{*} \AgdaBound{B} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{ΣT[+T]} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{Σtm[+tm]} \AgdaBound{a} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{Σtm[+tm]} \AgdaBound{b} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Σv} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{v0} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\})} \AgdaSymbol{=} \AgdaFunction{subst} \AgdaDatatype{Var} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaBound{A} \AgdaBound{A}\AgdaSymbol{))} \AgdaInductiveConstructor{v0}\<%
\\
\>\AgdaFunction{Σv} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{subst} \AgdaDatatype{Var} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaSymbol{\{\_\}} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaFunction{Σv} \AgdaBound{x}\AgdaSymbol{))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{Σtm} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaFunction{Σv} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Σtm} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaBound{x} \AgdaBound{δ} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{coh} \AgdaSymbol{(}\AgdaFunction{ΣC-Contr} \AgdaSymbol{\_} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{Σs} \AgdaBound{δ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{⟦} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{)} \AgdaFunction{⟫}\<%
\\
%
\\
%
\\
\>\AgdaFunction{Σtm-p1} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{Σtm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \<[61]%
\>[61]\<%
\\
\>\AgdaFunction{Σtm-p1} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{cohOpV} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaBound{A} \AgdaBound{A}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{Σtm-p2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaFunction{Σv} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{\{}B \AgdaSymbol{=} \AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{x}\AgdaSymbol{))} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaFunction{Σv} \AgdaBound{x}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{Σtm-p2} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaBound{A} \AgdaBound{B} \AgdaBound{x} \AgdaSymbol{=} \AgdaFunction{cohOpV} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{Σtm-p2-sp} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaFunction{Σtm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \AgdaDatatype{≅} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaFunction{+tm} \AgdaSymbol{\_}\<%
\\
\>\AgdaFunction{Σtm-p2-sp} \AgdaBound{A} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{Σtm-p2} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)} \AgdaBound{B} \AgdaInductiveConstructor{v0} \AgdaFunction{∾} \<[40]%
\>[40]\AgdaFunction{cong+tm} \AgdaSymbol{(}\AgdaFunction{Σtm-p1} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Σs} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{Σs} \AgdaBound{γ}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{Σtm} \AgdaBound{a} \AgdaFunction{⟦} \AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{γ} \AgdaFunction{⟫} \<[56]%
\>[56]\<%
\\
\>\AgdaFunction{Σs} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaFunction{Σs•} \AgdaBound{Γ}\<%
\\
%
\\
%
\\
\>\AgdaFunction{congΣtm} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{≅} \AgdaBound{b} \AgdaSymbol{→} \AgdaFunction{Σtm} \AgdaBound{a} \AgdaDatatype{≅} \AgdaFunction{Σtm} \AgdaBound{b}\<%
\\
\>\AgdaFunction{congΣtm} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{\_)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{cohOpΣtm} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{t} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{)(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{Σtm} \AgdaSymbol{(}\AgdaBound{t} \AgdaFunction{⟦} \AgdaBound{p} \AgdaFunction{⟫}\AgdaSymbol{)} \AgdaDatatype{≅} \AgdaFunction{Σtm} \AgdaBound{t}\<%
\\
\>\AgdaFunction{cohOpΣtm} \AgdaBound{t} \AgdaBound{p} \AgdaSymbol{=} \<[16]%
\>[16]\AgdaFunction{congΣtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaBound{p}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{Σs⊚} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaBound{Δ₁} \AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Δ₁}\AgdaSymbol{)(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{Σs} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⊚} \AgdaBound{γ}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{Σs} \AgdaBound{δ} \AgdaFunction{⊚} \AgdaFunction{Σs} \AgdaBound{γ}\<%
\\
%
\\
\>\AgdaFunction{Σv[Σs]v} \AgdaSymbol{:} \<[11]%
\>[11]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{Σv} \AgdaBound{x} \AgdaFunction{[} \AgdaFunction{Σs} \AgdaBound{δ} \AgdaFunction{]V} \AgdaDatatype{≅} \AgdaFunction{Σtm} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]V}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Σv[Σs]v} \AgdaSymbol{(}\AgdaInductiveConstructor{v0} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\})} \AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{Σtm-p1} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{cohOpΣtm} \AgdaBound{a} \AgdaFunction{+T[,]T} \AgdaFunction{-¹}\<%
\\
\>\AgdaFunction{Σv[Σs]v} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{Σtm-p2} \AgdaBound{A} \AgdaBound{B} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{∾}\<%
\\
\>[9]\AgdaIndent{39}{}\<[39]%
\>[39]\AgdaFunction{+tm[,]tm} \AgdaSymbol{(}\AgdaFunction{Σtm} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{))} \AgdaFunction{∾}\<%
\\
\>[9]\AgdaIndent{39}{}\<[39]%
\>[39]\AgdaFunction{Σv[Σs]v} \AgdaBound{x} \AgdaBound{δ} \AgdaFunction{∾} \AgdaFunction{cohOpΣtm} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]V}\AgdaSymbol{)} \AgdaFunction{+T[,]T} \AgdaFunction{-¹}\<%
\\
%
\\
\>\AgdaFunction{Σtm[Σs]tm} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \<[59]%
\>[59]\<%
\\
\>[16]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaFunction{Σtm} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{Σs} \AgdaBound{δ} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaFunction{Σtm} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Σtm[Σs]tm} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{δ} \AgdaSymbol{=} \AgdaFunction{Σv[Σs]v} \AgdaBound{x} \AgdaBound{δ}\<%
\\
\>\AgdaFunction{Σtm[Σs]tm} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaBound{Δ₁}\AgdaSymbol{\}} \AgdaBound{x} \AgdaBound{δ} \AgdaBound{A}\AgdaSymbol{)} \AgdaBound{δ₁} \AgdaSymbol{=} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{)))} \<[79]%
\>[79]\<%
\\
\>[0]\AgdaIndent{22}{}\<[22]%
\>[22]\AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \<[41]%
\>[41]\<%
\\
\>[0]\AgdaIndent{22}{}\<[22]%
\>[22]\AgdaFunction{∾} \AgdaFunction{coh-eq} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{Σs⊚} \AgdaBound{δ} \AgdaBound{δ₁}\AgdaSymbol{))} \<[48]%
\>[48]\<%
\\
\>[0]\AgdaIndent{22}{}\<[22]%
\>[22]\AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{cohOpΣtm} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⊚} \AgdaBound{δ₁}\AgdaSymbol{)} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[⊚]T}\AgdaSymbol{)} \<[64]%
\>[64]\<%
\\
\>[0]\AgdaIndent{22}{}\<[22]%
\>[22]\AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⊚} \AgdaBound{δ₁}\AgdaSymbol{))))} \AgdaFunction{-¹}\<%
\\
%
\\
\>\AgdaFunction{Σs•-left-id} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{Σs} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaInductiveConstructor{•} \AgdaDatatype{≡} \AgdaFunction{Σs} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaInductiveConstructor{•} \AgdaFunction{⊚} \AgdaFunction{Σs} \AgdaBound{γ}\<%
\\
\>\AgdaFunction{Σs•-left-id} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{Σs•-left-id} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{Σs•-left-id} \AgdaBound{γ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{⊚wk} \AgdaSymbol{(}\AgdaFunction{Σs•} \AgdaBound{Δ}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{Σs•-left-id} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{+S} \AgdaFunction{ΣT} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{Σs•-left-id} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaInductiveConstructor{•}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{S-eq} \AgdaSymbol{(}\AgdaFunction{S-eq} \AgdaInductiveConstructor{refl} \AgdaSymbol{(}\AgdaFunction{[+S]V} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaFunction{Σs•} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaFunction{-¹}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{[+S]V} \AgdaInductiveConstructor{v0} \AgdaSymbol{\{}\AgdaFunction{Σs•} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaFunction{-¹}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{Σs•-left-id} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A₁}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{Σs•-left-id} \AgdaBound{γ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{⊚wk} \AgdaSymbol{(}\AgdaFunction{Σs•} \AgdaBound{Δ}\AgdaSymbol{)))} \<[81]%
\>[81]\<%
\\
%
\\
\>\AgdaFunction{Σs⊚} \AgdaInductiveConstructor{•} \AgdaBound{γ} \AgdaSymbol{=} \AgdaFunction{Σs•-left-id} \AgdaBound{γ}\<%
\\
\>\AgdaFunction{Σs⊚} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{\_,\_} \AgdaBound{δ} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a}\AgdaSymbol{)} \AgdaBound{γ} \AgdaSymbol{=} \AgdaFunction{S-eq} \AgdaSymbol{(}\AgdaFunction{Σs⊚} \AgdaBound{δ} \AgdaBound{γ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{⊚} \AgdaBound{γ}\AgdaSymbol{))} \AgdaFunction{∾} \AgdaFunction{cohOpΣtm} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]tm}\AgdaSymbol{)} \AgdaFunction{[⊚]T} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{[⊚]T} \AgdaFunction{∾} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{))} \AgdaFunction{∾} \AgdaFunction{Σtm[Σs]tm} \AgdaBound{a} \AgdaBound{γ}\AgdaSymbol{)} \AgdaFunction{-¹}\AgdaSymbol{)} \<[162]%
\>[162]\<%
\\
%
\\
%
\\
\>\AgdaFunction{ΣT[+S]T} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{ΣT} \AgdaBound{A} \AgdaFunction{[} \AgdaFunction{Σs} \AgdaBound{δ} \AgdaFunction{+S} \AgdaFunction{ΣT} \AgdaBound{B} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)} \AgdaFunction{+T} \AgdaFunction{ΣT} \AgdaBound{B}\<%
\\
\>\AgdaFunction{ΣT[+S]T} \AgdaBound{A} \AgdaBound{δ} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{[+S]T} \AgdaSymbol{(}\AgdaFunction{wk-T} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{ΣsDis} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{))(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{Σs} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{))} \AgdaFunction{+S} \AgdaFunction{ΣT} \AgdaBound{B} \AgdaDatatype{≡} \AgdaFunction{Σs} \AgdaBound{δ} \AgdaFunction{+S} \AgdaFunction{ΣT} \AgdaBound{B} \AgdaInductiveConstructor{,} \AgdaSymbol{((}\AgdaFunction{Σtm} \AgdaBound{a}\AgdaSymbol{)} \AgdaFunction{+tm} \AgdaFunction{ΣT} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{⟦} \AgdaFunction{ΣT[+S]T} \AgdaBound{A} \AgdaBound{δ} \AgdaBound{B} \AgdaFunction{⟫}\<%
\\
\>\AgdaFunction{ΣsDis} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{δ} \AgdaBound{a} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{S-eq} \AgdaInductiveConstructor{refl} \AgdaSymbol{(}\AgdaFunction{wk-coh+} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{[+S]T} \AgdaSymbol{(}\AgdaFunction{wk-T} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{)))} \AgdaFunction{∾} \AgdaFunction{cong+tm2} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{))} \AgdaFunction{-¹}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{ΣsΣT} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{Σs} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{Σs} \AgdaBound{δ} \AgdaFunction{+S} \AgdaFunction{ΣT} \AgdaBound{B}\<%
\\
\>\AgdaFunction{ΣsΣT} \AgdaInductiveConstructor{•} \AgdaSymbol{\_} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{ΣsΣT} \AgdaSymbol{(}\AgdaInductiveConstructor{\_,\_} \AgdaBound{δ} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{S-eq} \AgdaSymbol{(}\AgdaFunction{ΣsΣT} \AgdaBound{δ} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{))} \AgdaFunction{∾} \AgdaFunction{cohOpΣtm} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{[+S]T} \AgdaFunction{∾} \AgdaFunction{Σtm[+tm]} \AgdaBound{a} \AgdaBound{B} \AgdaFunction{∾} \AgdaFunction{cong+tm2} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{wk-coh+} \AgdaFunction{-¹}\AgdaSymbol{)} \<[148]%
\>[148]\<%
\\
%
\\
\>\AgdaFunction{*'[Σs]T} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{*'} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaFunction{[} \AgdaFunction{Σs} \AgdaBound{δ} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaFunction{*'} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>\AgdaFunction{*'[Σs]T} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{*'[Σs]T} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaInductiveConstructor{•} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{[+S]T} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaFunction{*'} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\}\}} \AgdaSymbol{\{}δ \AgdaSymbol{=} \AgdaFunction{Σs} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaInductiveConstructor{•}\AgdaSymbol{\})} \AgdaSymbol{(}\AgdaFunction{wk-T} \AgdaSymbol{(}\AgdaFunction{*'[Σs]T} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaInductiveConstructor{•}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{*'[Σs]T} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{+T[,]T} \AgdaSymbol{(}\AgdaFunction{*'[Σs]T} \AgdaBound{γ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{ΣT[Σs]T} \AgdaInductiveConstructor{*} \AgdaBound{δ} \AgdaSymbol{=} \AgdaFunction{*'[Σs]T} \AgdaBound{δ}\<%
\\
\>\AgdaFunction{ΣT[Σs]T} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{δ} \AgdaSymbol{=} \AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{Σtm[Σs]tm} \AgdaBound{a} \AgdaBound{δ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{Σtm[Σs]tm} \AgdaBound{b} \AgdaBound{δ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Σtm[+tm]} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{cohOpV} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{Σtm[+tm]} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaBound{x} \AgdaBound{δ} \AgdaBound{A}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{cohOpΣtm} \AgdaSymbol{(}\AgdaInductiveConstructor{coh} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{)} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[+S]T}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B}\AgdaSymbol{)))} \AgdaFunction{∾} \AgdaFunction{coh-eq} \AgdaSymbol{(}\AgdaFunction{ΣsΣT} \AgdaBound{δ} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[+S]T}\AgdaSymbol{)} \AgdaFunction{-¹} \AgdaFunction{∾} \AgdaFunction{cong+tm2} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaBound{A} \AgdaBound{δ}\AgdaSymbol{))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{ΣC-Contr} \AgdaSymbol{.(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaInductiveConstructor{c*} \AgdaSymbol{=} \AgdaInductiveConstructor{ext} \AgdaInductiveConstructor{c*} \AgdaInductiveConstructor{v0}\<%
\\
\>\AgdaFunction{ΣC-Contr} \AgdaSymbol{.(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaBound{r} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{subst} \AgdaSymbol{(λ} \AgdaBound{y} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaSymbol{(}\AgdaFunction{ΣC} \AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaFunction{ΣT} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{y}\AgdaSymbol{))}\<%
\\
\>[22]\AgdaIndent{65}{}\<[65]%
\>[65]\AgdaSymbol{(}\AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{cohOpV} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaBound{A} \AgdaBound{A}\AgdaSymbol{))} \AgdaFunction{-¹}\AgdaSymbol{)}\<%
\\
\>[65]\AgdaIndent{66}{}\<[66]%
\>[66]\AgdaSymbol{(}\AgdaFunction{cohOpV} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaBound{A} \AgdaBound{A}\AgdaSymbol{))} \AgdaFunction{-¹}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{65}{}\<[65]%
\>[65]\AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaSymbol{(}\AgdaFunction{ΣC-Contr} \AgdaBound{Γ} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaFunction{ΣT} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{Σv} \AgdaBound{x}\AgdaSymbol{))}\<%
\\
\>\<\end{code}}
General suspension to the level of a type $A$ is defined by iteration of
one-level suspension. For symmetry and ease of reading the following
suspension functions take as a parameter a type $A$ in $\Gamma$, while they
depend only on its level. 

\begin{code}\>\<%
\\
\>\AgdaFunction{ΣC-it} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaDatatype{Con}\<%
\\
%
\\
\>\AgdaFunction{ΣT-it} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Σtm-it} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{B} \<[44]%
\>[44]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{suspend-S} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{Θ} \AgdaDatatype{⇒} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Θ}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{ΣC-it} \AgdaInductiveConstructor{*} \AgdaBound{Δ} \AgdaSymbol{=} \AgdaBound{Δ}\<%
\\
\>\AgdaFunction{ΣC-it} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{Δ} \AgdaSymbol{=} \AgdaFunction{ΣC} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{ΣT-it} \AgdaInductiveConstructor{*} \AgdaBound{B} \AgdaSymbol{=} \AgdaBound{B}\<%
\\
\>\AgdaFunction{ΣT-it} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\<%
\\
\>\AgdaFunction{Σtm-it} \AgdaInductiveConstructor{*} \AgdaBound{t} \AgdaSymbol{=} \AgdaBound{t}\<%
\\
\>\AgdaFunction{Σtm-it} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{t} \AgdaSymbol{=} \AgdaFunction{Σtm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaBound{t}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{suspend-S} \AgdaInductiveConstructor{*} \AgdaBound{γ} \AgdaSymbol{=} \AgdaBound{γ}\<%
\\
\>\AgdaFunction{suspend-S} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{γ} \AgdaSymbol{=} \AgdaFunction{Σs} \AgdaSymbol{(}\AgdaFunction{suspend-S} \AgdaBound{A} \AgdaBound{γ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{minimum-S} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaInductiveConstructor{ε}\<%
\\
%
\\
\>\AgdaFunction{ΣC-p1} \AgdaSymbol{:\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{ΣC} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{ΣC} \AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaFunction{ΣT} \AgdaBound{A}\<%
\\
\>\AgdaFunction{ΣC-p1} \AgdaInductiveConstructor{*} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{ΣC-p1} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
%
\\
\>\AgdaFunction{ΣC-it-p1} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ΣC-it-p1} \AgdaInductiveConstructor{*} \AgdaBound{B} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{ΣC-it-p1} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{cong} \AgdaFunction{ΣC} \AgdaSymbol{(}\AgdaFunction{ΣC-it-p1} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaComment{-- to split ΣC-it}\<%
\\
%
\\
\>\AgdaFunction{ΣC-it-S-spl'} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \<[49]%
\>[49]\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ΣC-it-S-spl'} \AgdaInductiveConstructor{*} \AgdaBound{B} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{ΣC-it-S-spl'} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{cong} \AgdaFunction{ΣC} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl'} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{ΣC-it-S-spl} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \<[48]%
\>[48]\<%
\\
\>[0]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ΣC-it-S-spl} \AgdaInductiveConstructor{*} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{IdS}\<%
\\
\>\AgdaFunction{ΣC-it-S-spl} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{Σs} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{ΣC-it-S-spl-¹} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \<[50]%
\>[50]\<%
\\
\>[15]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ΣC-it-S-spl-¹} \AgdaInductiveConstructor{*} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{IdS}\<%
\\
\>\AgdaFunction{ΣC-it-S-spl-¹} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{Σs} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl-¹} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{ΣC-it-S-spl2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)}\<%
\\
\>[-13]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \<[42]%
\>[42]\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*} \AgdaFunction{+T} \AgdaSymbol{\_)} \AgdaDatatype{⇒} \AgdaFunction{ΣC} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaInductiveConstructor{ε}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ΣC-it-S-spl2} \AgdaInductiveConstructor{*} \AgdaSymbol{=} \AgdaFunction{IdS}\<%
\\
\>\AgdaFunction{ΣC-it-S-spl2} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{Σs} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl2} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{⊚} \AgdaFunction{1-1S-same} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{ΣT-it-wk} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{B} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*} \AgdaFunction{+T} \AgdaSymbol{\_}\<%
\\
\>\AgdaFunction{ΣT-it-wk} \AgdaInductiveConstructor{*} \AgdaBound{B} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{ΣT-it-wk} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaFunction{ΣT-it-wk} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)))}\<%
\\
%
\\
\>\AgdaFunction{ΣT-it-p1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*} \AgdaFunction{[} \AgdaFunction{minimum-S} \AgdaBound{A} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A}\<%
\\
%
\\
\>\AgdaFunction{ΣT-it-p2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ΣT-it-p2} \AgdaInductiveConstructor{*} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{ΣT-it-p2} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\_} \AgdaSymbol{\_)} \AgdaSymbol{=} \AgdaFunction{cong} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p2} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{ΣT-it-p3} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{C} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{B} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{C} \AgdaFunction{+T} \AgdaSymbol{\_} \<[102]%
\>[102]\<%
\\
\>\AgdaFunction{ΣT-it-p3} \AgdaInductiveConstructor{*} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{+T[,]T} \AgdaSymbol{(}\AgdaFunction{wk+S+T} \AgdaFunction{IC-T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ΣT-it-p3} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{C} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p3} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{C}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{minimum-S} \AgdaInductiveConstructor{*} \AgdaSymbol{=} \AgdaInductiveConstructor{•}\<%
\\
\>\AgdaFunction{minimum-S} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{ΣC-it-S-spl2} \AgdaBound{A} \AgdaFunction{⊚} \AgdaSymbol{((}\AgdaFunction{minimum-S} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaBound{a} \AgdaFunction{⟦} \AgdaFunction{ΣT-it-p1} \AgdaBound{A} \AgdaFunction{⟫}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaFunction{wk-tm} \AgdaSymbol{(}\AgdaBound{b} \AgdaFunction{⟦} \AgdaFunction{ΣT-it-p1} \AgdaBound{A} \AgdaFunction{⟫}\AgdaSymbol{)))}\<%
\\
%
\\
%
\\
\>\AgdaFunction{ΣC-it-ε-Contr} \AgdaSymbol{:} \<[17]%
\>[17]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ΣC-it-ε-Contr} \AgdaInductiveConstructor{*} \AgdaBound{isC} \AgdaSymbol{=} \AgdaBound{isC}\<%
\\
\>\AgdaFunction{ΣC-it-ε-Contr} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{isC} \AgdaSymbol{=} \AgdaFunction{ΣC-Contr} \AgdaSymbol{\_} \AgdaSymbol{(}\AgdaFunction{ΣC-it-ε-Contr} \AgdaBound{A} \AgdaBound{isC}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{wk-susp} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{⟦} \AgdaFunction{ΣT-it-p1} \AgdaBound{A} \AgdaFunction{⟫} \AgdaDatatype{≅} \AgdaBound{a}\<%
\\
\>\AgdaFunction{wk-susp} \AgdaBound{A} \AgdaBound{a} \AgdaSymbol{=} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p1} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{fci-l1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{ΣC-it-S-spl2} \AgdaBound{A} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{fci-l1} \AgdaInductiveConstructor{*} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{fci-l1} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{[⊚]T} \AgdaSymbol{(}\AgdaFunction{trans}\<%
\\
\>[0]\AgdaIndent{38}{}\<[38]%
\>[38]\AgdaSymbol{(}\AgdaFunction{congT}\<%
\\
\>[38]\AgdaIndent{39}{}\<[39]%
\>[39]\AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{ΣT[Σs]T} \AgdaSymbol{(}\AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl2} \AgdaBound{A}\AgdaSymbol{))}\<%
\\
\>[39]\AgdaIndent{40}{}\<[40]%
\>[40]\AgdaSymbol{(}\AgdaFunction{cong} \AgdaFunction{ΣT} \AgdaSymbol{(}\AgdaFunction{fci-l1} \AgdaBound{A}\AgdaSymbol{))))}\<%
\\
\>[-37]\AgdaIndent{38}{}\<[38]%
\>[38]\AgdaSymbol{(}\AgdaFunction{hom≡}\<%
\\
\>[0]\AgdaIndent{41}{}\<[41]%
\>[41]\AgdaSymbol{(}\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{Σtm-p2-sp} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*} \AgdaFunction{+T} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{))} \AgdaFunction{∾}\<%
\\
\>[41]\AgdaIndent{42}{}\<[42]%
\>[42]\AgdaFunction{1-1S-same-tm} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{41}{}\<[41]%
\>[41]\AgdaSymbol{(}\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{Σtm-p1} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*} \AgdaFunction{+T} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{))} \AgdaFunction{∾}\<%
\\
\>[0]\AgdaIndent{44}{}\<[44]%
\>[44]\AgdaFunction{1-1S-same-v0} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{))))} \AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{ΣT-it-p1} \<[10]%
\>[10]\AgdaInductiveConstructor{*} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{ΣT-it-p1} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{[⊚]T} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{fci-l1} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{prf} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{prf} \AgdaBound{b}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{prf} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{a} \AgdaFunction{⟦} \AgdaFunction{ΣT-it-p1} \AgdaBound{A} \AgdaFunction{⟫}\AgdaSymbol{)} \AgdaFunction{⟦} \AgdaFunction{+T[,]T} \AgdaFunction{⟫}\AgdaSymbol{)} \AgdaFunction{⟦} \AgdaFunction{+T[,]T} \AgdaFunction{⟫} \AgdaDatatype{≅} \AgdaBound{a}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{prf} \AgdaBound{a} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{wk-susp} \AgdaBound{A} \AgdaBound{a}\<%
\\
\>[0]\AgdaIndent{1}{}\<[1]%
\>[1]\<%
\\
%
\\
%
\\
\>\AgdaFunction{Σtm-it-p1} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{B} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
\>\AgdaFunction{Σtm-it-p1} \AgdaInductiveConstructor{*} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{wk+S+T} \AgdaFunction{IC-T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Σtm-it-p1} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{Σtm[Σs]tm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{congΣtm} \AgdaSymbol{(}\AgdaFunction{Σtm-it-p1} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{cohOpV} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{ΣT[+T]} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)))}\<%
\\
%
\\
%
\\
%
\\
\>\AgdaFunction{Σtm-it-p2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{)))} \AgdaFunction{[} \AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{C} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{+tm} \AgdaSymbol{\_}\<%
\\
\>\AgdaFunction{Σtm-it-p2} \AgdaInductiveConstructor{*} \AgdaBound{x} \AgdaSymbol{=} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{[+S]V} \AgdaBound{x} \AgdaFunction{∾} \AgdaFunction{cong+tm} \AgdaSymbol{(}\AgdaFunction{IC-v} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Σtm-it-p2} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C}\AgdaSymbol{\}} \AgdaBound{x} \AgdaSymbol{=} \AgdaFunction{Σtm[Σs]tm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{)))} \AgdaSymbol{(}\AgdaFunction{ΣC-it-S-spl} \AgdaBound{A} \AgdaBound{C}\AgdaSymbol{)} \AgdaFunction{∾}\<%
\\
\>[0]\AgdaIndent{47}{}\<[47]%
\>[47]\AgdaFunction{congΣtm} \AgdaSymbol{(}\AgdaFunction{Σtm-it-p2} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{∾}\<%
\\
\>[0]\AgdaIndent{47}{}\<[47]%
\>[47]\AgdaFunction{Σtm[+tm]} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{C}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
}
\noindent Finally, it is clear that iterated suspension preserves contractibility. 

\begin{code}\>\<%
\\
\>\AgdaFunction{ΣC-it-Contr} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaBound{Δ} \<[45]%
\>[45]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaFunction{ΣC-it-Contr} \AgdaInductiveConstructor{*} \AgdaBound{x} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{ΣC-it-Contr} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaInductiveConstructor{\_=h\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{x} \AgdaSymbol{=} \AgdaFunction{ΣC-Contr} \AgdaSymbol{(}\AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣC-it-Contr} \AgdaBound{A} \AgdaBound{x}\AgdaSymbol{)} \<[76]%
\>[76]\<%
\\
\>\<\end{code}
}
By suspending the minimal contractible context,
*, we obtain a so-called \emph{span}. They are stalks with a top variable added. For example $(x_0: *)$ (the one-variable
context) for $n=0$; $(x_0 : *, x_1 : *, x_2 : x_0\,=_\mathsf{h}\,x_1)$ for
$n=1$; $(x_0 : *, x_1 : *, x_2 : x_0\,=_\mathsf{h}\,x_1, x_3 :
x_0\,=_{\mathsf{h}}\,x_1, x_4 : x_2\,=_\mathsf{h}\,x_3)$ for $n=2$, etc. 
Spans play
an important role later in the definition of composition. 
% Following is a picture of the first few spans for increasing levels $n$ of \AgdaBound{A}.
% \[
% \begin{array}{c@{\hspace{1.5cm}} c@{\hspace{1.5cm}} c@{\hspace{1.5cm}} c@{\hspace{1.5cm}} c@{\hspace{1.5cm}}}
% &&&&8\\
% &&&6&6\quad 7\\
% &&4&4\quad 5&4 \quad 5\\
% &2&2\quad 3&2\quad 3&2\quad 3\\
% 0&0\quad 1&0\quad 1&0\quad 1&0\quad 1\\
% \\
% n = 0&n=1&n=2&n=3&n=4
% \end{array}
% \]

\subsubsection{Replacement}
\label{sec:replacement}

After we have suspended a context by inserting an appropriate number of
variables, we may proceed to a substitution which, so to speak, fills the stalk for
$A$ with $A$. The context morphism representing this substitution is
called $\AgdaFunction{filter}$. In the final step we combine it with
$\Gamma$, the context of $A$.  The new context contains two parts, the
first is the same as $\Gamma$, and the second is the suspended $\Delta$
substituted by $\AgdaFunction{filter}$. However, we also have to drop
the stalk of $A$ becuse it already exists in $\Gamma$.

This operation is called \emph{replacement} because we can interpret it as replacing $*$ in $\Delta$ by
$A$.

As always, we define replacement for contexts, types and terms simultaneously:

\begin{code}\>\<%
\\
\>\AgdaFunction{rpl-C} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaDatatype{Con}\<%
\\
\>\AgdaFunction{rpl-T} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaSymbol{(}\AgdaFunction{rpl-C} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rpl-tm} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{B} \<[44]%
\>[44]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
Replacement for contexts, $\AgdaFunction{rpl-C}$, defines for a type $A$ in $\Gamma$ and another context $\Delta$ 
a context which begins as $\Gamma$ and follows by each type of $\Delta$ with $*$ replaced with (pasted onto)  $A$. 

\begin{code}\>\<%
\\
\>\AgdaFunction{rpl-C} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaBound{A} \AgdaInductiveConstructor{ε} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaBound{Γ}\<%
\\
\>\AgdaFunction{rpl-C} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{)} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaFunction{rpl-T} \AgdaBound{A} \AgdaBound{B}\<%
\\
\>\<\end{code}
\noindent To this end we must define the substitution $\AgdaFunction{filter}$ which
pulls back each type from suspended $\Delta$ to the new context. 

\begin{code}\>\<%
\\
\>\AgdaFunction{filter} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \<[34]%
\>[34]\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaFunction{ΣC-it} \AgdaBound{A} \AgdaBound{Δ}\<%
\\
%
\\
\>\AgdaFunction{rpl-T} \AgdaBound{A} \AgdaBound{B} \AgdaSymbol{=} \AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B} \AgdaFunction{[} \AgdaFunction{filter} \AgdaSymbol{\_} \AgdaBound{A} \AgdaFunction{]T}\<%
\\
\>\<\end{code}

\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaFunction{rpl-pr1} \<[9]%
\>[9]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Γ}\<%
\\
%
\\
\>\AgdaComment{\{-
filter : \{Γ Δ Θ : Con\}(A : Ty Γ) → Θ ⇒ Δ → (rpl-C A Θ) ⇒ (rpl-C A Δ)
-\}}\<%
\\
%
\\
\>\AgdaFunction{rpl-pr1} \AgdaInductiveConstructor{ε} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{IdS}\<%
\\
\>\AgdaFunction{rpl-pr1} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaBound{A₁} \AgdaSymbol{=} \AgdaFunction{rpl-pr1} \AgdaBound{Δ} \AgdaBound{A₁} \AgdaFunction{+S} \AgdaSymbol{\_}\<%
\\
%
\\
%
\\
%
\\
\>\AgdaFunction{filter} \AgdaInductiveConstructor{ε} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{minimum-S} \AgdaBound{A}\<%
\\
\>\AgdaFunction{filter} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaBound{A₁} \AgdaSymbol{=} \<[21]%
\>[21]\AgdaFunction{ΣC-it-S-spl} \AgdaBound{A₁} \AgdaBound{A} \AgdaFunction{⊚} \AgdaSymbol{((}\AgdaFunction{filter} \AgdaBound{Δ} \AgdaBound{A₁} \AgdaFunction{+S} \AgdaSymbol{\_)} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{⟦} \AgdaFunction{[+S]T} \AgdaFunction{⟫}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{rpl-T-p1} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{rpl-T} \AgdaBound{A} \AgdaInductiveConstructor{*} \AgdaDatatype{≡} \AgdaBound{A} \AgdaFunction{[} \AgdaFunction{rpl-pr1} \AgdaBound{Δ} \AgdaBound{A} \AgdaFunction{]T}\<%
\\
\>\AgdaFunction{rpl-T-p1} \AgdaInductiveConstructor{ε} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p1} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{IC-T}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rpl-T-p1} \AgdaSymbol{(}\AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaBound{A₁} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{[⊚]T} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{ΣT-it-wk} \AgdaBound{A₁} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{+T[,]T} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{[+S]T} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{wk-T} \AgdaSymbol{(}\AgdaFunction{rpl-T-p1} \AgdaBound{Δ} \AgdaBound{A₁}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaFunction{[+S]T}\AgdaSymbol{)))))}\<%
\\
%
\\
\>\AgdaFunction{rpl-tm} \AgdaBound{A} \AgdaBound{a} \AgdaSymbol{=} \AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaBound{a} \AgdaFunction{[} \AgdaFunction{filter} \AgdaSymbol{\_} \AgdaBound{A} \AgdaFunction{]tm}\<%
\\
%
\\
%
\\
\>\AgdaFunction{rpl-tm-id} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaBound{A} \AgdaInductiveConstructor{*}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rpl-tm-id} \AgdaBound{x} \AgdaSymbol{=} \<[15]%
\>[15]\AgdaBound{x} \AgdaFunction{⟦} \AgdaFunction{ΣT-it-p1} \AgdaSymbol{\_} \AgdaFunction{⟫}\<%
\\
%
\\
%
\\
\>\AgdaFunction{rpl-T-p2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{B}\AgdaSymbol{\}} \<[63]%
\>[63]\AgdaSymbol{→} \AgdaFunction{rpl-T} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaFunction{rpl-tm} \AgdaBound{A} \AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaFunction{rpl-tm} \AgdaBound{A} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rpl-T-p2} \AgdaBound{Δ} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p2} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{rpl-T-p3} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaFunction{rpl-T} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{C} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{rpl-T} \AgdaBound{A} \AgdaBound{C} \AgdaFunction{+T} \AgdaSymbol{\_}\<%
\\
\>\AgdaFunction{rpl-T-p3} \AgdaSymbol{\_} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{[⊚]T} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p3} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{+T[,]T} \AgdaFunction{[+S]T}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{rpl-T-p3-wk} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{((}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B} \AgdaFunction{[} \AgdaFunction{filter} \AgdaBound{Δ} \AgdaBound{A} \AgdaFunction{]T}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T}\AgdaSymbol{)\}}\<%
\\
\>[8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaFunction{rpl-T} \AgdaBound{A} \AgdaSymbol{(}\AgdaBound{C} \AgdaFunction{+T} \AgdaBound{B}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{b} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaFunction{rpl-T} \AgdaBound{A} \AgdaBound{C} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T}\<%
\\
\>\AgdaFunction{rpl-T-p3-wk} \AgdaBound{Δ} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{rpl-T-p3} \AgdaBound{Δ} \AgdaBound{A}\AgdaSymbol{))} \AgdaFunction{+T[,]T}\<%
\\
%
\\
\>\AgdaFunction{rpl-tm-v0'} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[10]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{→} \AgdaFunction{rpl-tm} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
\>\AgdaFunction{rpl-tm-v0'} \AgdaBound{Δ} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{[⊚]tm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \AgdaFunction{∾} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{Σtm-it-p1} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaFunction{wk-coh+}\<%
\\
%
\\
\>\AgdaFunction{rpl-tm-v0} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{b'} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{((}\AgdaFunction{ΣT-it} \AgdaBound{A} \AgdaBound{B} \AgdaFunction{[} \AgdaFunction{filter} \AgdaBound{Δ} \AgdaBound{A} \AgdaFunction{]T}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{prf} \AgdaSymbol{:} \AgdaBound{b'} \AgdaDatatype{≅} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaFunction{rpl-tm} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{b'} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{b}\<%
\\
\>\AgdaFunction{rpl-tm-v0} \AgdaBound{Δ} \AgdaBound{A} \AgdaBound{prf} \AgdaSymbol{=} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{rpl-tm-v0'} \AgdaBound{Δ} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{∾} \AgdaFunction{wk-coh} \AgdaFunction{∾} \AgdaBound{prf}\<%
\\
%
\\
%
\\
\>\AgdaFunction{rpl-tm-vS} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{Δ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaBound{Δ}\AgdaSymbol{\}}\<%
\\
\>[10]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaBound{A} \AgdaBound{B} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]T}\AgdaSymbol{)\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{rpl-tm} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaBound{Δ} \AgdaInductiveConstructor{,} \AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{))} \AgdaFunction{[} \AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{b} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaFunction{rpl-tm} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{[} \AgdaBound{γ} \AgdaFunction{]tm}\<%
\\
\>\AgdaFunction{rpl-tm-vS} \AgdaBound{Δ} \AgdaBound{A} \AgdaSymbol{\{}x \AgdaSymbol{=} \AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{[⊚]tm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaBound{x}\AgdaSymbol{)))} \AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{Σtm-it-p2} \AgdaBound{A} \AgdaBound{x}\AgdaSymbol{))} \<[90]%
\>[90]\AgdaFunction{∾} \AgdaFunction{+tm[,]tm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{))} \<[121]%
\>[121]\AgdaFunction{∾} \AgdaSymbol{(}\AgdaFunction{[+S]tm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{))))} \AgdaFunction{∾} \AgdaFunction{+tm[,]tm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{filter} \AgdaSymbol{\_} \AgdaBound{A} \AgdaFunction{]tm}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaComment{-- basic example}\<%
\\
%
\\
\>\AgdaFunction{base-1} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{base-1} \AgdaSymbol{=} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaSymbol{\_} \AgdaInductiveConstructor{,} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p1} \AgdaSymbol{\_)}\<%
\\
%
\\
%
\\
%
\\
\>\AgdaFunction{map-1} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{map-1} \AgdaSymbol{=} \AgdaFunction{1-1S-same} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p1} \AgdaSymbol{\_)}\<%
\\
%
\\
\>\AgdaComment{-- some useful lemmas}\<%
\\
%
\\
\>\AgdaFunction{rpl*-A} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{rpl-T} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaInductiveConstructor{ε}\AgdaSymbol{\}} \AgdaBound{A} \AgdaInductiveConstructor{*} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A}\<%
\\
\>\AgdaFunction{rpl*-A} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{IC-T} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p1} \AgdaSymbol{\_)}\<%
\\
%
\\
\>\AgdaFunction{rpl*-a} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{rpl-tm} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaFunction{⟦} \AgdaFunction{rpl*-A} \AgdaFunction{⟫} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaBound{a}\<%
\\
\>\AgdaFunction{rpl*-a} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{rpl-tm-v0} \AgdaInductiveConstructor{ε} \AgdaBound{A} \<[26]%
\>[26]\AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{rpl*-A} \AgdaSymbol{\{}A \AgdaSymbol{=} \AgdaBound{A}\AgdaSymbol{\}))}\<%
\\
%
\\
\>\AgdaFunction{rpl*-A2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{*} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε}\AgdaSymbol{\})} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaFunction{]T}\AgdaSymbol{)\}} \<[65]%
\>[65]\<%
\\
\>[-5]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaFunction{rpl-T} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{*} \AgdaSymbol{\{}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{\})} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaBound{A}\<%
\\
\>\AgdaFunction{rpl*-A2} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{rpl-T-p3-wk} \AgdaInductiveConstructor{ε} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{rpl*-A}\<%
\\
%
\\
\>\AgdaFunction{rpl-xy} \AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaFunction{rpl-T} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaFunction{⟦} \AgdaFunction{rpl*-A} \AgdaFunction{⟫} \AgdaInductiveConstructor{,} \AgdaBound{b} \AgdaFunction{⟦} \AgdaFunction{rpl*-A2} \AgdaBound{A} \AgdaFunction{⟫} \AgdaFunction{]T}\<%
\\
\>[7]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rpl-xy} \AgdaBound{A} \AgdaBound{a} \AgdaBound{b} \AgdaSymbol{=} \<[16]%
\>[16]\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{rpl-T-p2} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaBound{A}\AgdaSymbol{))} \<[55]%
\>[55]\<%
\\
\>[-6]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{hom≡} \AgdaSymbol{((}\AgdaFunction{rpl-tm-vS} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaBound{A}\AgdaSymbol{)} \<[43]%
\>[43]\AgdaFunction{∾} \AgdaFunction{rpl*-a} \AgdaBound{A}\AgdaSymbol{)} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{19}{}\<[19]%
\>[19]\AgdaSymbol{(}\AgdaFunction{rpl-tm-v0} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaBound{A} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{rpl*-A2} \AgdaBound{A}\AgdaSymbol{))))}\<%
\\
%
\\
%
\\
%
\\
\>\AgdaFunction{rpl-sub} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaFunction{rpl-C} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{rpl-sub} \AgdaBound{Γ} \AgdaBound{A} \AgdaBound{a} \AgdaBound{b} \AgdaBound{t} \AgdaSymbol{=} \AgdaFunction{IdS} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaFunction{⟦} \AgdaFunction{rpl*-A} \AgdaFunction{⟫} \AgdaInductiveConstructor{,} \AgdaBound{b} \AgdaFunction{⟦} \AgdaFunction{rpl*-A2} \AgdaBound{A} \AgdaFunction{⟫} \AgdaInductiveConstructor{,} \AgdaBound{t} \AgdaFunction{⟦} \AgdaFunction{rpl-xy} \AgdaBound{A} \AgdaBound{a} \AgdaBound{b} \AgdaFunction{⟫}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\<%
\\
%
\\
\>\<\end{code}
}


%\input{GroupoidStructure}

\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaSymbol{\{-\#} \AgdaKeyword{OPTIONS} --type-in-type --no-positivity-check --no-termination-check \AgdaSymbol{\#-\}}\<%
\\
%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{GroupoidStructure} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \<[50]%
\>[50]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}\_,\_ \AgdaSymbol{to} \_,,\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat}\<%
\\
%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{BasicSyntax} \AgdaKeyword{renaming} \AgdaSymbol{(}\_∾\_ \AgdaSymbol{to} htrans\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{IdentityContextMorphisms}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Suspension}\<%
\\
%
\\
\>\<\end{code}
}

\subsection{First-level Groupoid Structure}
We can proceed to the definition of the groupoid structure of the syntax. We start with the base case: 1-cells. Replacement defined above allows us to lift this structure to an arbitrary level $n$ (we leave most of the routine details out). This shows that the syntax is a 1-groupoid on each level. In the next section we show how also the higher-groupoid structure can be defined. 

We start by an essential lemma which formalises the discussion at the
beginning of this section: to construct a term in a type $A$ in an
arbitrary context, we first restrict attention to a suitable
contractible context $\Delta$ and use lifting and substitution -- replacement -- to pull
 the term built by $\AgdaInductiveConstructor{coh}$ in $\Delta$
back. This relies on the fact that a lifted contractible context is
also contractible, and therefore any type lifted from a contractible
context is also inhabited.

\begin{code}\>\<%
\\
\>\AgdaFunction{Coh-rpl} \<[9]%
\>[9]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaBound{Δ}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Coh-rpl} \AgdaSymbol{\{\_\}} \AgdaSymbol{\{}\AgdaBound{Δ}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{\_} \AgdaBound{isC} \AgdaSymbol{=} \AgdaInductiveConstructor{coh} \AgdaSymbol{(}\AgdaFunction{ΣC-it-ε-Contr} \AgdaBound{A} \AgdaBound{isC}\AgdaSymbol{)} \AgdaSymbol{\_} \AgdaSymbol{\_}\<%
\\
\>\<\end{code}
Next we define the reflexivity, symmetry and transitivity terms of any type. Let's start from some base cases. Each of the base cases is derivable in a different contractible context with \AgdaFunction{Coh-Contr} which gives you a coherence constant for any type in any contractible context.

\noindent \textbf{Reflexivity} (identity) It only requires a one-object context.

\begin{code}\>\<%
\\
\>\AgdaFunction{refl*-Tm} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{refl*-Tm} \AgdaSymbol{=} \AgdaFunction{Coh-Contr} \AgdaInductiveConstructor{c*}\<%
\\
\>\<\end{code}
\noindent  \textbf{Symmetry} (inverse) It is defined similarly. Note that the intricate names of contexts, as in \AgdaDatatype{Ty} \AgdaFunction{x:*,y:*,α:x=y} indicate their definitions which have been hidden. Agda treats all sequences of characters uninterrupted by whitespace as identifiers. For instance \AgdaFunction{x:*,y:*,α:x=y} is a name of a context for which we are assuming the definition:

$\AgdaFunction{x:*,y:*,α:x=y} \AgdaSymbol{=} \AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}$.


\begin{code}\>\<%
\\
\>\AgdaFunction{sym*-Ty} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaFunction{x:*,y:*,α:x=y}\<%
\\
\>\AgdaFunction{sym*-Ty} \AgdaSymbol{=} \AgdaFunction{vY} \AgdaInductiveConstructor{=h} \AgdaFunction{vX}\<%
\\
%
\\
\>\AgdaFunction{sym*-Tm} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y}\AgdaSymbol{\}} \AgdaFunction{sym*-Ty}\<%
\\
\>\AgdaFunction{sym*-Tm} \AgdaSymbol{=} \AgdaFunction{Coh-Contr} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaInductiveConstructor{c*} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
\textbf{Transitivity} (composition)

\begin{code}\>\<%
\\
\>\AgdaFunction{trans*-Ty} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaFunction{x:*,y:*,α:x=y,z:*,β:y=z}\<%
\\
\>\AgdaFunction{trans*-Ty} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{vX} \AgdaFunction{+tm} \AgdaSymbol{\_} \AgdaFunction{+tm} \AgdaSymbol{\_)} \AgdaInductiveConstructor{=h} \AgdaFunction{vZ}\<%
\\
%
\\
\>\AgdaFunction{trans*-Tm} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaFunction{trans*-Ty}\<%
\\
\>\AgdaFunction{trans*-Tm} \AgdaSymbol{=} \AgdaFunction{Coh-Contr} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaInductiveConstructor{c*} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))}\<%
\\
\>\<\end{code}
\noindent To obtain these terms for any given type in any give context, we use replacement.

\begin{code}\>\<%
\\
\>\AgdaFunction{refl-Tm} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \<[33]%
\>[33]\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaFunction{x:*}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{refl-Tm} \AgdaBound{A} \<[11]%
\>[11]\AgdaSymbol{=} \AgdaFunction{rpl-tm} \AgdaBound{A} \AgdaFunction{refl*-Tm}\<%
\\
%
\\
\>\AgdaFunction{sym-Tm} \<[10]%
\>[10]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaBound{A} \AgdaFunction{sym*-Ty}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{sym-Tm} \AgdaBound{A} \<[10]%
\>[10]\AgdaSymbol{=} \AgdaFunction{rpl-tm} \AgdaBound{A} \AgdaFunction{sym*-Tm}\<%
\\
%
\\
\>\AgdaFunction{trans-Tm} \<[12]%
\>[12]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaBound{A} \AgdaFunction{trans*-Ty}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{trans-Tm} \AgdaBound{A} \<[12]%
\>[12]\AgdaSymbol{=} \AgdaFunction{rpl-tm} \AgdaBound{A} \AgdaFunction{trans*-Tm}\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaComment{-- The version without lifting function}\<%
\\
%
\\
\>\AgdaFunction{refl-Tm'} \AgdaSymbol{:} \<[12]%
\>[12]\AgdaSymbol{\{}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{refl-Tm'} \AgdaBound{A} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{refl-Tm} \AgdaBound{A}\AgdaSymbol{)} \<[26]%
\>[26]\AgdaFunction{[} \AgdaFunction{map-1} \AgdaFunction{]tm} \AgdaFunction{⟦} \AgdaFunction{prf1} \AgdaFunction{⟫}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{prf} \AgdaSymbol{:} \AgdaFunction{rpl-tm} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaFunction{x:*}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{map-1} \AgdaFunction{]tm} \AgdaDatatype{≅} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{prf} \AgdaSymbol{=} \AgdaFunction{htrans} \AgdaSymbol{(}\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{htrans} \AgdaSymbol{(}\AgdaFunction{[⊚]tm} \AgdaSymbol{(}\AgdaFunction{Σtm-it} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)))} \<[61]%
\>[61]\<%
\\
\>[4]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaFunction{htrans} \AgdaSymbol{(}\AgdaFunction{congtm} \AgdaSymbol{(}\AgdaFunction{Σtm-it-p1} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{htrans} \AgdaFunction{wk-coh} \AgdaFunction{wk-coh+}\AgdaSymbol{))))} \<[68]%
\>[68]\<%
\\
\>[10]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaFunction{1-1S-same-v0} \AgdaSymbol{(}\AgdaFunction{ΣT-it-p1} \AgdaBound{A}\AgdaSymbol{))}\<%
\\
%
\\
\>[-3]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{prf1} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{rpl-T} \AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaFunction{x:*}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{map-1} \AgdaFunction{]T}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{prf1} \AgdaSymbol{=} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{rpl-T-p2} \AgdaFunction{x:*} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{hom≡} \AgdaFunction{prf} \AgdaFunction{prf}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{refl-Fun} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{=h} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{refl-Fun} \AgdaBound{Γ} \AgdaBound{A} \AgdaBound{x} \AgdaSymbol{=} \<[18]%
\>[18]\AgdaSymbol{(}\AgdaFunction{refl-Tm} \AgdaBound{A}\AgdaSymbol{)} \<[30]%
\>[30]\<%
\\
\>[4]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{[} \AgdaFunction{IdS} \AgdaInductiveConstructor{,} \AgdaBound{x} \AgdaFunction{⟦} \AgdaFunction{rpl*-A} \AgdaFunction{⟫} \AgdaFunction{]tm} \<[42]%
\>[42]\<%
\\
\>[4]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaFunction{⟦} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{rpl-T-p2} \AgdaFunction{x:*} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{rpl*-a} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{rpl*-a} \AgdaBound{A}\AgdaSymbol{)))} \AgdaFunction{⟫}\<%
\\
%
\\
\>\AgdaFunction{Tm-sym-fun} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \<[33]%
\>[33]\<%
\\
\>[6]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \<[20]%
\>[20]\AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \<[63]%
\>[63]\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \<[20]%
\>[20]\AgdaSymbol{\{}Δ \AgdaSymbol{=} \AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{\}} \AgdaBound{A} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{Tm-sym-fun} \AgdaBound{Γ} \AgdaBound{A} \AgdaSymbol{=} \AgdaFunction{fun} \AgdaSymbol{(}\AgdaFunction{sym-Tm} \AgdaBound{A} \AgdaFunction{⟦} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{rpl-T-p3} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{⟫}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Tm-sym-fun2} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \<[34]%
\>[34]\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \<[53]%
\>[53]\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{Tm-sym-fun2} \AgdaBound{Γ} \AgdaBound{A} \AgdaBound{t} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaBound{t} \AgdaFunction{[} \AgdaSymbol{(}\AgdaFunction{wk-id} \AgdaInductiveConstructor{,} \<[16]%
\>[16]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{⟦} \AgdaFunction{eq1} \AgdaFunction{⟫}\AgdaSymbol{))} \AgdaInductiveConstructor{,}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaFunction{⟦} \AgdaFunction{eq2} \AgdaFunction{⟫}\AgdaSymbol{)} \AgdaFunction{]tm}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{⟦} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaFunction{wk-hom} \AgdaSymbol{(}\AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{htrans} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{+T[,]T}\AgdaSymbol{)} \<[51]%
\>[51]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{eq1}\AgdaSymbol{))} \<[17]%
\>[17]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaFunction{eq2}\AgdaSymbol{)))} \AgdaFunction{⟫}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{wk-id} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)} \AgdaDatatype{⇒} \AgdaBound{Γ} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{wk-id} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{IdS} \AgdaFunction{+S} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{+S} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{eq1} \AgdaSymbol{:} \AgdaBound{A} \AgdaFunction{[} \AgdaFunction{wk-id} \AgdaFunction{]T} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{+T} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)} \<[46]%
\>[46]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{eq1} \AgdaSymbol{=} \AgdaFunction{wk+S+T} \AgdaSymbol{(}\AgdaFunction{wk+S+T} \AgdaFunction{IC-T}\AgdaSymbol{)}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{eq2} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{wk-id} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0} \AgdaFunction{⟦} \AgdaFunction{eq1} \AgdaFunction{⟫}\AgdaSymbol{)} \AgdaFunction{]T} \<[49]%
\>[49]\<%
\\
\>[4]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{+T} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{+T} \AgdaBound{A}\AgdaSymbol{)} \<[35]%
\>[35]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{eq2} \AgdaSymbol{=} \AgdaFunction{trans} \AgdaFunction{+T[,]T} \AgdaFunction{eq1}\<%
\\
%
\\
\>\AgdaFunction{Fun-sym} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{Γ} \AgdaSymbol{:} \AgdaDatatype{Con}\AgdaSymbol{)(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)(}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{a} \AgdaInductiveConstructor{=h} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{7}{}\<[7]%
\>[7]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{b} \AgdaInductiveConstructor{=h} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Fun-sym} \AgdaBound{Γ} \AgdaBound{A} \AgdaBound{a} \AgdaBound{b} \AgdaBound{t} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{sym-Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaFunction{[} \AgdaFunction{rpl-sub} \AgdaBound{Γ} \AgdaBound{A} \AgdaBound{a} \AgdaBound{b} \AgdaBound{t} \AgdaFunction{]tm} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaFunction{⟦} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{rpl-T-p3-wk} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{(}\AgdaFunction{congT} \AgdaSymbol{(}\AgdaFunction{rpl-T-p2} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaBound{A}\AgdaSymbol{))} \<[90]%
\>[90]\<%
\\
\>[9]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{(}\AgdaFunction{hom≡} \AgdaSymbol{(}\AgdaFunction{rpl-tm-v0} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaBound{A} \AgdaSymbol{(}\AgdaFunction{cohOp} \AgdaSymbol{(}\AgdaFunction{rpl*-A2} \AgdaBound{A}\AgdaSymbol{)))} \AgdaSymbol{(}\AgdaFunction{htrans} \AgdaSymbol{(}\AgdaFunction{rpl-tm-vS} \AgdaSymbol{(}\AgdaInductiveConstructor{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*}\AgdaSymbol{)} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[11]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaSymbol{(}\AgdaFunction{rpl*-a} \AgdaBound{A}\AgdaSymbol{)))))} \AgdaFunction{⟫}\<%
\\
%
\\
%
\\
\>\<\end{code}
}
For each of reflexivity, symmetry and transitivity we can construct appropriate coherence 2-cells witnessing the groupoid laws. The base case for variable contexts is proved simply using contractibility as well. However the types of these laws are not as trivial as the proving parts. We use substitution to define the application of the three basic terms we have defined above.

\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaFunction{reflX} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{vX} \AgdaInductiveConstructor{=h} \AgdaFunction{vX}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{reflX} \AgdaSymbol{=} \AgdaFunction{refl-Tm} \AgdaInductiveConstructor{*} \AgdaFunction{+tm} \AgdaSymbol{\_} \AgdaFunction{+tm} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{reflY} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{vY} \AgdaInductiveConstructor{=h} \AgdaFunction{vY}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{reflY} \AgdaSymbol{=} \AgdaFunction{refl-Tm} \AgdaInductiveConstructor{*} \AgdaFunction{+tm} \AgdaSymbol{\_}\<%
\\
%
\\
\>\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q} \AgdaSymbol{:} \AgdaDatatype{Con}\<%
\\
\>\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q} \AgdaSymbol{=} \AgdaFunction{x:*,y:*,α:x=y,z:*,β:y=z} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{*} \AgdaInductiveConstructor{,} \AgdaSymbol{(}\AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \AgdaInductiveConstructor{=h} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{vM} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q}\AgdaSymbol{\}} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaFunction{vM} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))))))}\<%
\\
%
\\
\>\AgdaFunction{vN} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q}\AgdaSymbol{\}} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaFunction{vN} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)))))}\<%
\\
%
\\
\>\AgdaFunction{vMN} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{vM} \AgdaInductiveConstructor{=h} \AgdaFunction{vN}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{vMN} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))))}\<%
\\
%
\\
\>\AgdaFunction{vP} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q}\AgdaSymbol{\}} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaFunction{vP} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)))}\<%
\\
%
\\
\>\AgdaFunction{vNP} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{vN} \AgdaInductiveConstructor{=h} \AgdaFunction{vP}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{vNP} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{vQ} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q}\AgdaSymbol{\}} \AgdaInductiveConstructor{*}\<%
\\
\>\AgdaFunction{vQ} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{vPQ} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{vP} \AgdaInductiveConstructor{=h} \AgdaFunction{vQ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{vPQ} \AgdaSymbol{=} \AgdaInductiveConstructor{var} \AgdaInductiveConstructor{v0}\<%
\\
%
\\
\>\AgdaFunction{Ty-G-assoc*} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaFunction{m:*,n:*,α:m=n,p:*,β:n=p,q:*,γ:p=q}\<%
\\
\>\AgdaFunction{Ty-G-assoc*} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{trans*-Tm} \AgdaFunction{[} \AgdaSymbol{((((}\AgdaInductiveConstructor{•} \AgdaInductiveConstructor{,} \AgdaFunction{vM}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vP}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \<[47]%
\>[47]\<%
\\
\>[17]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{trans*-Tm} \AgdaFunction{[} \AgdaFunction{pr1} \AgdaFunction{⊚} \AgdaFunction{pr1} \AgdaFunction{]tm}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaFunction{vQ}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vPQ} \AgdaFunction{]tm} \AgdaInductiveConstructor{=h} \<[71]%
\>[71]\<%
\\
\>[-7]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{trans*-Tm} \AgdaFunction{[} \AgdaSymbol{(}\AgdaFunction{pr1} \AgdaFunction{⊚} \AgdaFunction{pr1} \AgdaFunction{⊚} \AgdaFunction{pr1} \AgdaFunction{⊚} \AgdaFunction{pr1} \AgdaInductiveConstructor{,} \AgdaFunction{vQ}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \<[56]%
\>[56]\<%
\\
\>[0]\AgdaIndent{23}{}\<[23]%
\>[23]\AgdaSymbol{(}\AgdaFunction{trans*-Tm} \AgdaFunction{[} \AgdaSymbol{((((}\AgdaInductiveConstructor{•} \AgdaInductiveConstructor{,} \AgdaFunction{vN}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vP}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vNP}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vQ}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vPQ} \AgdaFunction{]tm}\AgdaSymbol{)} \AgdaFunction{]tm}\AgdaSymbol{)}\<%
\\
%
\\
\>\<\end{code}
}

\begin{code}\>\<%
\\
\>\AgdaFunction{Tm-right-identity*} \AgdaSymbol{:} \<[21]%
\>[21]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{trans*-Tm} \AgdaFunction{[} \AgdaFunction{IdS} \AgdaInductiveConstructor{,} \AgdaFunction{vY} \AgdaInductiveConstructor{,} \AgdaFunction{reflY} \AgdaFunction{]tm} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{=h} \AgdaFunction{vα}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Tm-right-identity*} \AgdaSymbol{=} \AgdaFunction{Coh-Contr} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaInductiveConstructor{c*} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Tm-left-identity*} \AgdaSymbol{:} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{trans*-Tm} \AgdaFunction{[} \AgdaSymbol{((}\AgdaFunction{IdS} \AgdaFunction{⊚} \AgdaFunction{pr1} \AgdaFunction{⊚} \AgdaFunction{pr1}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vX}\AgdaSymbol{)} \AgdaInductiveConstructor{,}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{reflX} \AgdaInductiveConstructor{,} \AgdaFunction{vY} \AgdaInductiveConstructor{,} \AgdaFunction{vα} \AgdaFunction{]tm} \AgdaInductiveConstructor{=h} \AgdaFunction{vα}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Tm-left-identity*} \AgdaSymbol{=} \AgdaFunction{Coh-Contr} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaInductiveConstructor{c*} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Tm-right-inverse*} \AgdaSymbol{:} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{trans*-Tm} \AgdaFunction{[} \AgdaSymbol{(}\AgdaFunction{IdS} \AgdaInductiveConstructor{,} \AgdaFunction{vX}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{sym*-Tm} \AgdaFunction{]tm} \<[59]%
\>[59]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{=h} \AgdaFunction{reflX}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Tm-right-inverse*} \AgdaSymbol{=} \AgdaFunction{Coh-Contr} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaInductiveConstructor{c*} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Tm-left-inverse*} \AgdaSymbol{:} \<[19]%
\>[19]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaDatatype{Tm} \AgdaSymbol{\{}\AgdaFunction{x:*,y:*,α:x=y}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{trans*-Tm} \AgdaFunction{[} \AgdaSymbol{((}\AgdaInductiveConstructor{•} \AgdaInductiveConstructor{,} \AgdaFunction{vY}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vX} \AgdaInductiveConstructor{,} \AgdaFunction{sym*-Tm} \AgdaInductiveConstructor{,}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{vY}\AgdaSymbol{)} \AgdaInductiveConstructor{,} \AgdaFunction{vα} \AgdaFunction{]tm} \AgdaInductiveConstructor{=h} \AgdaFunction{reflY}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Tm-left-inverse*} \AgdaSymbol{=} \AgdaFunction{Coh-Contr} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaInductiveConstructor{c*} \AgdaInductiveConstructor{v0}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{Tm-G-assoc*} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaFunction{Ty-G-assoc*}\<%
\\
\>\AgdaFunction{Tm-G-assoc*} \<[13]%
\>[13]\AgdaSymbol{=} \AgdaFunction{Coh-Contr} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaSymbol{(}\AgdaInductiveConstructor{ext} \AgdaInductiveConstructor{c*} \AgdaInductiveConstructor{v0}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))} \<[56]%
\>[56]\<%
\\
\>[2]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaInductiveConstructor{v0}\AgdaSymbol{))}\<%
\\
\>\<\end{code}
\noindent Their general versions are defined using replacement. For instance, for associativity, we define:

\begin{code}\>\<%
\\
\>\AgdaFunction{Tm-G-assoc} \<[14]%
\>[14]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Γ}\AgdaSymbol{)} \<[31]%
\>[31]\<%
\\
\>[13]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaFunction{rpl-T} \AgdaBound{A} \AgdaFunction{Ty-G-assoc*}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{Tm-G-assoc} \AgdaBound{A} \<[14]%
\>[14]\AgdaSymbol{=} \AgdaFunction{rpl-tm} \AgdaBound{A} \AgdaFunction{Tm-G-assoc*} \<[37]%
\>[37]\<%
\\
\>\<\end{code}
Following the same pattern, the $n$-level groupoid laws can be
obtained as the coherence constants as well.

%\input{Telescopes2}
\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaSymbol{\{-\#} \AgdaKeyword{OPTIONS} --type-in-type --no-positivity-check --no-termination-check \AgdaSymbol{\#-\}}\<%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{Telescopes2} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \<[50]%
\>[50]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}\_,\_ \AgdaSymbol{to} \_,,\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{BasicSyntax} \AgdaKeyword{renaming} \AgdaSymbol{(}\_∾\_ \AgdaSymbol{to} htrans\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{IdentityContextMorphisms}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Suspension}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{GroupoidStructure}\<%
\\
\>\<\end{code}
}
\subsection{Higher Structure} In the previous text we have shown how
to define 1-groupoid structure on an arbitrary level. Here we indicate
how all levels also bear the structure of $n$-groupoid for arbitrary
$n$. The rough idea amounts to redefining telescopes of \cite{txa:csl}
in terms of appropriate contexts, which are contractible, and the different
constructors for terms used in \cite{txa:csl} in terms of
$\mathsf{coh}$.

To illustrate this we consider the simpler example of higher
identities. Note that the domain and codomain of $n\text{+}1$-iterated
identity are $n$-iterated identities. Hence we proceed by induction on
$n$. Denote a span of depth $n$ $S_n$. Then there is a chain of
context morphisms $S_0 \Rightarrow S_1 \Rightarrow \cdots \Rightarrow
S_n$. Each $S_{n+1}$ has one additional variable standing for the
identity iterated $n\text{+}1$-times. Because $S_{n+1}$ is contractible, one
can define a morphism $S_n \Rightarrow S_{n+1}$ using $\AgdaInductiveConstructor{coh}$
to fill the last variable and variable terms on the first $n$
levels. By composition of the context morphisms one defines $n$ new
terms in the basic one variable context $*$ -- the iterated
identities. Finally, using suspension one can lift the identities to an
arbitrary level.

Each $n$-cell has $n$-compositions. In the case of
2-categories, 1-cells have one composition, 2-cells have vertical and
horizontal composition. Two 2-cells are horizontally composable only
if their 1-cell top and bottom boundaries are composable. The boundary
of the composition is the composition of the boundaries.  Thus for
arbitrary $n$ we proceed using a chain of $V$-shaped contractible
contexts. That is contexts that are two spans conjoined at the base
level at a common middle variable. Each successive composition is
defined using contractibility and \AgdaInductiveConstructor{coh}.

To fully imitate the development in \cite{txa:csl}, one would
also have to define all higher coherence laws. But the sole purpose
of giving an alternative type theory in this chapter is to avoid that. 


\vspace*{2\baselineskip}
\section{Semantics}

\subsection{Globular Types}

%\input{GlobularTypes}

\AgdaHide{

\begin{code}\>\<%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{GlobularTypes} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Coinduction}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality}\<%
\\
%
\\
\>\<\end{code}
}

To interpret the syntax, we need globular types
\footnote{The Agda \AgdaPrimitiveType{Set} stands for an arbitrary type, not a set in the sense of Homotopy Type Theory.}
. Globular types are defined coinductively as follows:

\begin{code}\>\<%
\\
\>\AgdaKeyword{record} \AgdaRecord{Glob} \AgdaSymbol{:} \AgdaPrimitiveType{Set₁} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{constructor} \AgdaInductiveConstructor{\_∣∣\_}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∣\_∣} \<[10]%
\>[10]\AgdaSymbol{:} \AgdaPrimitiveType{Set}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{hom} \<[9]%
\>[9]\AgdaSymbol{:} \AgdaBound{∣\_∣} \AgdaSymbol{→} \AgdaBound{∣\_∣} \AgdaSymbol{→} \AgdaDatatype{∞} \AgdaRecord{Glob}\<%
\\
\>\<\end{code}
\AgdaHide{
\begin{code}\>\<%
\\
\>\AgdaKeyword{open} \AgdaModule{Glob} \AgdaKeyword{public}\<%
\\
\>\<\end{code}
}
If all the object types ($\AgdaField{∣\_∣}$) are indeed sets, i.e.\
UIP holds for them, we call this a globular set.

%Indeed, we should assume the 0-level object to be an h-set, namely the equality of any two terms of it should be unique. 

As an example, we could construct the identity globular type called $\AgdaFunction{Idω}$.

\begin{code}\>\<%
\\
\>\AgdaFunction{Idω} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{Glob}\<%
\\
\>\AgdaFunction{Idω} \AgdaBound{A} \<[7]%
\>[7]\AgdaSymbol{=} \AgdaBound{A} \AgdaInductiveConstructor{∣∣} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaBound{b} \AgdaSymbol{→} \AgdaCoinductiveConstructor{♯} \AgdaFunction{Idω} \AgdaSymbol{(}\AgdaBound{a} \AgdaDatatype{≡} \AgdaBound{b}\AgdaSymbol{))}\<%
\\
\>\<\end{code}
% Note that this is usually not a globular set, because UIP does not necessary for object types on each level, i.e.\ $\AgdaBound{A}$, $\AgdaBound{a}\AgdaDatatype{≡}\AgdaBound{b}$ and so on.

\AgdaHide{
\begin{code}\>\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_≅'\_} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{\}} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣} \AgdaSymbol{→} \<[45]%
\>[45]\AgdaFunction{∣} \AgdaBound{B} \AgdaFunction{∣} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{refl} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{\_≅'\_} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{a} \AgdaBound{a}\<%
\\
%
\\
%
\\
\>\AgdaFunction{EqGlob} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{Σ} \AgdaSymbol{(}\AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣} \AgdaDatatype{≡} \AgdaFunction{∣} \AgdaBound{B} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{(λ} \AgdaBound{p} \AgdaSymbol{→} \AgdaFunction{subst} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaSymbol{→} \AgdaDatatype{∞} \AgdaRecord{Glob}\AgdaSymbol{)} \AgdaBound{p} \AgdaSymbol{(}\AgdaFunction{hom} \AgdaBound{A}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{hom} \AgdaBound{B}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{EqGlob} \AgdaSymbol{.}\AgdaBound{B} \AgdaBound{B} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{EqHom} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{m} \AgdaBound{n} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{B} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaBound{p} \AgdaBound{x} \AgdaDatatype{≡} \AgdaBound{m}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaBound{p} \AgdaBound{y} \AgdaDatatype{≡} \AgdaBound{n}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{♭} \AgdaSymbol{(}\AgdaFunction{hom} \AgdaBound{A} \AgdaBound{x} \AgdaBound{y}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{♭} \AgdaSymbol{(}\AgdaFunction{hom} \AgdaBound{B} \AgdaBound{m} \AgdaBound{n}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{EqHom} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{B}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaInductiveConstructor{refl} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{m}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{n}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{m}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}} \AgdaInductiveConstructor{refl} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{subst-p1} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣}\AgdaSymbol{)(}\AgdaBound{p} \AgdaBound{q} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaBound{p} \AgdaBound{x} \AgdaDatatype{≡} \AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaBound{q} \AgdaBound{x}\<%
\\
\>\AgdaFunction{subst-p1} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{∣\_∣} \AgdaInductiveConstructor{∣∣} \AgdaSymbol{.}\AgdaBound{hom}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{∣\_∣} \AgdaInductiveConstructor{∣∣} \AgdaBound{hom}\AgdaSymbol{\}} \AgdaBound{x} \AgdaInductiveConstructor{refl} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{subst-p2} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{A} \AgdaBound{B} \AgdaBound{C} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣}\AgdaSymbol{)(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{B} \AgdaDatatype{≡} \AgdaBound{C}\AgdaSymbol{)(}\AgdaBound{q} \AgdaSymbol{:} \AgdaBound{A} \AgdaDatatype{≡} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaBound{p} \AgdaSymbol{(}\AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaBound{q} \AgdaBound{x}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaBound{q} \AgdaBound{p}\AgdaSymbol{)} \AgdaBound{x}\<%
\\
\>\AgdaFunction{subst-p2} \AgdaSymbol{\{}\AgdaSymbol{.}\AgdaBound{∣\_∣} \AgdaInductiveConstructor{∣∣} \AgdaSymbol{.}\AgdaBound{hom}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{∣\_∣} \AgdaInductiveConstructor{∣∣} \AgdaBound{hom}\AgdaSymbol{\}} \AgdaBound{x} \AgdaInductiveConstructor{refl} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{[\_]\_≅s\_} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{B} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{B} \AgdaFunction{∣} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{refl} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{[} \AgdaBound{A} \AgdaDatatype{]} \AgdaBound{b} \AgdaDatatype{≅s} \AgdaBound{b}\<%
\\
%
\\
\>\AgdaComment{-- universe definition}\<%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{UniverseGS} \AgdaSymbol{(}\AgdaBound{U} \AgdaSymbol{:} \AgdaPrimitiveType{Set}\AgdaSymbol{)(}\AgdaBound{El} \AgdaSymbol{:} \AgdaBound{U} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\AgdaSymbol{)} \AgdaKeyword{where}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{record} \AgdaRecord{uGlob} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{field}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{∣\_∣u} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaBound{U}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{uhom} \AgdaSymbol{:} \AgdaBound{El} \AgdaBound{∣\_∣u} \AgdaSymbol{→} \AgdaBound{El} \AgdaBound{∣\_∣u} \AgdaSymbol{→} \AgdaDatatype{∞} \AgdaRecord{uGlob}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{open} \AgdaModule{uGlob}\<%
\\
%
\\
%
\\
\>\AgdaComment{-- Globular Sets indexed by Types}\<%
\\
%
\\
\>\AgdaFunction{Π} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set}\AgdaSymbol{)(}\AgdaBound{B} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaRecord{Glob}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaRecord{Glob}\<%
\\
\>\AgdaFunction{Π} \AgdaBound{A} \AgdaBound{B} \AgdaSymbol{=} \<[8]%
\>[8]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{record} \<[9]%
\>[9]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{\{} \AgdaField{∣\_∣} \<[9]%
\>[9]\AgdaSymbol{=} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{B} \AgdaBound{a} \AgdaFunction{∣}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{;} \AgdaField{hom} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaBound{f} \AgdaBound{g} \AgdaSymbol{→} \AgdaCoinductiveConstructor{♯} \AgdaFunction{Π} \AgdaBound{A} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{♭} \AgdaSymbol{(}\AgdaFunction{hom} \AgdaSymbol{(}\AgdaBound{B} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{g} \AgdaBound{x}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaComment{-- Globular Sets indexed by Globular Sets}\<%
\\
%
\\
\>\AgdaComment{-- looks good but we may require it covertible to some Glob}\<%
\\
\>\AgdaKeyword{record} \AgdaRecord{\_⇒Glob} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{)} \AgdaSymbol{:} \AgdaPrimitiveType{Set₁} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∣\_∣f} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{homf} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{a} \AgdaBound{a'} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{A} \AgdaFunction{∣}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{∣\_∣f} \AgdaBound{a} \AgdaSymbol{→} \AgdaBound{∣\_∣f} \AgdaBound{a'} \AgdaSymbol{→} \AgdaFunction{♭} \AgdaSymbol{(}\AgdaFunction{hom} \AgdaBound{A} \AgdaBound{a} \AgdaBound{a'}\AgdaSymbol{)} \AgdaRecord{⇒Glob}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{\_⇒Glob}\<%
\\
%
\\
%
\\
\>\<\end{code}

}

%\input{Semantics}

\AgdaHide{

\begin{code}\>\<%
\\
\>\AgdaSymbol{\{-\#} \AgdaKeyword{OPTIONS} --no-positivity-check --no-termination-check \AgdaSymbol{\#-\}}\<%
\\
%
\\
%
\\
%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{Semantics} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{BasicSyntax}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{IdentityContextMorphisms}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Unit}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Coinduction}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \AgdaKeyword{hiding} \AgdaSymbol{(}[\_]\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{GroupoidStructure}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{GlobularTypes}\<%
\\
%
\\
%
\\
\>\AgdaFunction{coerce} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{A} \AgdaBound{B} \AgdaSymbol{:} \AgdaPrimitiveType{Set}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{B} \AgdaDatatype{≡} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{B}\<%
\\
\>\AgdaFunction{coerce} \AgdaInductiveConstructor{refl} \AgdaBound{a} \AgdaSymbol{=} \AgdaBound{a}\<%
\\
%
\\
\>\AgdaFunction{⊤-uni} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set}\AgdaSymbol{\}\{}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{A} \AgdaDatatype{≡} \AgdaRecord{⊤} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{≡} \AgdaBound{b}\<%
\\
\>\AgdaFunction{⊤-uni} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\<\end{code}
}
Given a globular type $G$, we can interpret the syntactic objects.

\begin{code}\>\<%
\\
\>\AgdaKeyword{record} \AgdaRecord{Semantic} \AgdaSymbol{(}\AgdaBound{G} \AgdaSymbol{:} \AgdaRecord{Glob}\AgdaSymbol{)} \AgdaSymbol{:} \AgdaPrimitiveType{Set₁} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧C} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaDatatype{Con} \AgdaSymbol{→} \AgdaPrimitiveType{Set}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧T} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Ty} \AgdaBound{Γ} \AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C} \AgdaSymbol{→} \AgdaRecord{Glob}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧tm} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Tm} \AgdaBound{A} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)} \<[42]%
\>[42]\<%
\\
\>[4]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{A} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaFunction{∣}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧S} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ} \AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C} \AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{Δ} \AgdaBound{⟧C}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{π} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Var} \AgdaBound{A} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)} \<[43]%
\>[43]\<%
\\
\>[4]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{A} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaFunction{∣}\<%
\\
\>\<\end{code}
$\AgdaField{π}$ provides the projection of the semantic variable out of a semantic context.

Following are the computation laws for the interpretations of contexts and types.

\begin{code}\>\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧C-β1} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaBound{⟦} \AgdaInductiveConstructor{ε} \AgdaBound{⟧C} \AgdaDatatype{≡} \AgdaRecord{⊤}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧C-β2} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaInductiveConstructor{,} \AgdaBound{A} \AgdaBound{⟧C} \AgdaDatatype{≡} \<[38]%
\>[38]\<%
\\
\>[4]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaRecord{Σ} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C} \AgdaSymbol{(λ} \AgdaBound{γ} \<[28]%
\>[28]\AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{A} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaFunction{∣}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧T-β1} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{⟦} \AgdaInductiveConstructor{*} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaDatatype{≡} \AgdaBound{G}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧T-β2} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{A} \AgdaBound{u} \AgdaBound{v}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{u} \AgdaInductiveConstructor{=h} \AgdaBound{v} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaDatatype{≡}\<%
\\
\>[4]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{♭} \AgdaSymbol{(}\AgdaFunction{hom} \AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{A} \AgdaBound{⟧T} \AgdaBound{γ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{u} \AgdaBound{⟧tm} \AgdaBound{γ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{v} \AgdaBound{⟧tm} \AgdaBound{γ}\AgdaSymbol{))}\<%
\\
\>\<\end{code}
Semantic substitution and semantic weakening laws are also required.
The semantic substitution properties are essential for dealing with substitutions inside interpretation,

\begin{code}\>\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{semSb-T} \<[14]%
\>[14]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaDatatype{≡} \AgdaBound{⟦} \AgdaBound{A} \AgdaBound{⟧T} \AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{δ} \AgdaBound{⟧S} \AgdaBound{γ}\AgdaSymbol{)}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{semSb-tm} \<[14]%
\>[14]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaSymbol{(}\AgdaBound{semSb-T} \AgdaBound{A} \AgdaBound{δ} \AgdaBound{γ}\AgdaSymbol{)} \<[55]%
\>[55]\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{a} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]tm} \AgdaBound{⟧tm} \AgdaBound{γ}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{⟦} \AgdaBound{a} \AgdaBound{⟧tm} \AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{δ} \AgdaBound{⟧S} \AgdaBound{γ}\AgdaSymbol{)}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{semSb-S} \<[14]%
\>[14]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{Θ}\AgdaSymbol{\}(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{θ} \AgdaSymbol{:} \AgdaBound{Δ} \AgdaDatatype{⇒} \AgdaBound{Θ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{θ} \AgdaFunction{⊚} \AgdaBound{δ} \AgdaBound{⟧S} \AgdaBound{γ} \AgdaDatatype{≡} \<[43]%
\>[43]\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaBound{⟦} \AgdaBound{θ} \AgdaBound{⟧S} \AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{δ} \AgdaBound{⟧S} \AgdaBound{γ}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
Since the computation laws for the interpretations of terms and context morphisms are well typed up to these properties.

\begin{code}\>\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧tm-β1} \<[14]%
\>[14]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaBound{⟦} \AgdaInductiveConstructor{var} \AgdaBound{x} \AgdaBound{⟧tm} \AgdaBound{γ} \AgdaDatatype{≡} \AgdaBound{π} \AgdaBound{x} \AgdaBound{γ}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧S-β1} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{\}} \<[32]%
\>[32]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{→} \AgdaBound{⟦} \AgdaInductiveConstructor{•} \AgdaBound{⟧S} \AgdaBound{γ} \AgdaDatatype{≡} \AgdaFunction{coerce} \AgdaBound{⟦\_⟧C-β1} \AgdaInductiveConstructor{tt}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦\_⟧S-β2} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaSymbol{(}\AgdaBound{A} \AgdaFunction{[} \AgdaBound{δ} \AgdaFunction{]T}\AgdaSymbol{)\}} \AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{δ} \AgdaInductiveConstructor{,} \AgdaBound{a} \AgdaBound{⟧S} \AgdaBound{γ} \<[48]%
\>[48]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaDatatype{≡} \AgdaFunction{coerce} \AgdaBound{⟦\_⟧C-β2} \AgdaSymbol{((}\AgdaBound{⟦} \AgdaBound{δ} \AgdaBound{⟧S} \AgdaBound{γ}\AgdaSymbol{)} \AgdaInductiveConstructor{,}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaSymbol{(}\AgdaBound{semSb-T} \AgdaBound{A} \AgdaBound{δ} \AgdaBound{γ}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{a} \AgdaBound{⟧tm} \AgdaBound{γ}\AgdaSymbol{))}\<%
\\
\>\<\end{code}
The semantic weakening properties should actually be derivable since weakening is equivalent to projection substitution.

\begin{code}\>\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{semWk-T} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{\}(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)(}\AgdaBound{v} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{B} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaFunction{∣}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{A} \AgdaFunction{+T} \AgdaBound{B} \AgdaBound{⟧T} \AgdaSymbol{(}\AgdaFunction{coerce} \AgdaBound{⟦\_⟧C-β2} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{v}\AgdaSymbol{))} \AgdaDatatype{≡} \<[54]%
\>[54]\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaBound{⟦} \AgdaBound{A} \AgdaBound{⟧T} \AgdaBound{γ}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{semWk-S} \<[13]%
\>[13]\AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{Δ} \AgdaBound{B}\AgdaSymbol{\}\{}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{\}\{}\AgdaBound{v} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{B} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaFunction{∣}\AgdaSymbol{\}}\<%
\\
\>[4]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{δ} \AgdaSymbol{:} \AgdaBound{Γ} \AgdaDatatype{⇒} \AgdaBound{Δ}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{⟦} \AgdaBound{δ} \AgdaFunction{+S} \AgdaBound{B} \AgdaBound{⟧S} \<[41]%
\>[41]\<%
\\
\>[4]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaFunction{coerce} \AgdaBound{⟦\_⟧C-β2} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{v}\AgdaSymbol{))} \AgdaDatatype{≡} \AgdaBound{⟦} \AgdaBound{δ} \AgdaBound{⟧S} \AgdaBound{γ}\<%
\\
%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{semWk-tm} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{Γ} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{\}(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)(}\AgdaBound{v} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{B} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaFunction{∣}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaDatatype{Tm} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaSymbol{(}\AgdaBound{semWk-T} \AgdaBound{γ} \AgdaBound{v}\AgdaSymbol{)} \<[52]%
\>[52]\<%
\\
\>[13]\AgdaIndent{15}{}\<[15]%
\>[15]\AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{a} \AgdaFunction{+tm} \AgdaBound{B} \AgdaBound{⟧tm} \AgdaSymbol{(}\AgdaFunction{coerce} \AgdaBound{⟦\_⟧C-β2} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{v}\AgdaSymbol{)))} \<[56]%
\>[56]\<%
\\
\>[15]\AgdaIndent{17}{}\<[17]%
\>[17]\AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{⟦} \AgdaBound{a} \AgdaBound{⟧tm} \AgdaBound{γ}\AgdaSymbol{)}\<%
\\
\>\<\end{code}
Here we declare them as properties because they are essential for the computation laws of function $\AgdaField{π}$.

\begin{code}\>\<%
\\
\>[-2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{π-β1} \<[10]%
\>[10]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{A}\AgdaSymbol{\}(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)(}\AgdaBound{v} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{A} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaFunction{∣}\AgdaSymbol{)} \<[49]%
\>[49]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaSymbol{(}\AgdaBound{semWk-T} \AgdaBound{γ} \AgdaBound{v}\AgdaSymbol{)} \<[36]%
\>[36]\<%
\\
\>[10]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{(}\AgdaBound{π} \AgdaInductiveConstructor{v0} \AgdaSymbol{(}\AgdaFunction{coerce} \AgdaBound{⟦\_⟧C-β2} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{v}\AgdaSymbol{)))} \AgdaDatatype{≡} \AgdaBound{v}\<%
\\
%
\\
\>[-2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{π-β2} \<[10]%
\>[10]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Γ} \AgdaBound{A} \AgdaBound{B}\AgdaSymbol{\}(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Var} \AgdaBound{A}\AgdaSymbol{)(}\AgdaBound{γ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Γ} \AgdaBound{⟧C}\AgdaSymbol{)(}\AgdaBound{v} \AgdaSymbol{:} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{B} \AgdaBound{⟧T} \AgdaBound{γ} \AgdaFunction{∣}\AgdaSymbol{)} \<[62]%
\>[62]\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaFunction{subst} \AgdaFunction{∣\_∣} \AgdaSymbol{(}\AgdaBound{semWk-T} \AgdaBound{γ} \AgdaBound{v}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{π} \AgdaSymbol{(}\AgdaInductiveConstructor{vS} \AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B}\AgdaSymbol{\}} \AgdaBound{x}\AgdaSymbol{)} \<[58]%
\>[58]\<%
\\
\>[10]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{(}\AgdaFunction{coerce} \AgdaBound{⟦\_⟧C-β2} \AgdaSymbol{(}\AgdaBound{γ} \AgdaInductiveConstructor{,} \AgdaBound{v}\AgdaSymbol{)))} \AgdaDatatype{≡} \AgdaBound{π} \AgdaBound{x} \AgdaBound{γ}\<%
\\
\>\<\end{code}
The only part of the semantics where we have any freedom is the interpretation of the coherence constants:

\begin{code}\>\<%
\\
\>[-2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{⟦coh⟧} \<[11]%
\>[11]\AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{Θ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{isContr} \AgdaBound{Θ} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaDatatype{Ty} \AgdaBound{Θ}\AgdaSymbol{)} \<[43]%
\>[43]\<%
\\
\>[0]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{θ} \AgdaSymbol{:} \AgdaBound{⟦} \AgdaBound{Θ} \AgdaBound{⟧C}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{⟦} \AgdaBound{A} \AgdaBound{⟧T} \AgdaBound{θ} \AgdaFunction{∣}\<%
\\
\>\<\end{code}
However, we also need to require that the coherence constants are well
behaved with respect to substitution which in turn relies on the interpretation
of all terms. To address this we state the required properties in a
redundant form because the correctness for any other part of the
syntax follows from the defining equations we have already
stated. There seems to be no way to avoid this.

If the underlying globular type is not a globular set we need to add coherence laws, which is not very well understood. On the other hand, restricting ourselves to globular sets means that our prime example $\AgdaFunction{Idω}$ is not an instance anymore. We should still be able to construct non-trivial globular sets, e.g.\ by encoding basic topological notions and defining higher homotopies as in a classical framework. However, we do not currently know a simple definition of a globular set which is a weak $\omega$-groupoid. One possibility would be to use the syntax of type theory with equality types. Indeed, we believe that this would be an alternative way to formalize weak $\omega$-groupoids.



\section{Summary}

In this chapter, we presented an implementation of \wog following Brunerie's suggestion. Briefly speaking, we defined the syntax of the type theory \tig, then a weak $\omega$-groupoid is a globular set with the interpretation of the syntax. To overcome some technical problems, we used heterogeneous equality for terms, some auxiliary functions and loop context in all implementation. We constructed the identity morphisms and verified some groupoid laws in the syntactic framework. The suspensions for all sorts of objects were also defined for other later constructions.
