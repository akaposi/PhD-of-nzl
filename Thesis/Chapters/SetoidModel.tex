\chapter{The Setoid Model}
\label{sm}
% always forgets the "the"





Altenkirch investigates this issue and gives a solution in
\cite{alti:lics99}. He proposes an extension of \itt by a universe of
propositions $\Prop$ in which all proofs of same propositions are
definitionally equal, namely the theory is proof irrelevant. At the same time,
a setoid model where types are interpreted by a type and an equivalence relation acts as the metatheory and $\eta$-rules for
$\Pi$-types and $\Sigma$-types hold in the metatheory. The extended type
theory generated from the metatheory is decidable and adequate, $Ext$ is
inhabited and it permits large elimination (defining a dependent type by recursion). Within this type theory,
introduction of quotient types is straightforward. 
The set of functions are naturally quotient types, the hidden information is the
definition of the functions and the equivalence relation is the
functional extensionality.







\todo{the Setoid Model}

Quotient types are one of the extensional concepts in Type Theory \cite{hof:phd}. There are several existing intensional models for extensional
concepts. The first one we are going to work with is Altenkirch's
setoid model. To introduce an extensional propositional equality in \itt{}, 
Altenkirch \cite{alti:lics99} proposes an intensional setoid model
with a proof-irrelevant universe of propositions \textbf{Prop}.


\begin{equation}[proof-irr]
\begin{aligned}
\Gamma \vdash P : \textbf{Prop} & & \Gamma \vdash p,q : P & \\
\midrule
& \Gamma \vdash p=q : P & \\
\end{aligned}
\end{equation}

It only contains "propositional'' sets which has at most one
inhabitant. Notice that it is not a definition of types, which means
that we cannot conclude a type is of type \textbf{Prop} if we have a
proof that all
inhabitants are definitionally equal.

The propositional universe is closed under "$\Pi$" and "$\Sigma$", namely dependent functions
and dependent products.

\begin{equation}[\Pi-Prop]
\begin{aligned}
\Gamma \vdash A : \textbf{Set} & & \Gamma,x : A \vdash P \in \textbf{Prop} & \\
\midrule
& \Gamma \vdash \Pi\, x : A.P & \\
\end{aligned}
\end{equation}



\begin{equation}[\Sigma-Prop]
\begin{aligned}
\Gamma \vdash P : \textbf{Prop} & & \Gamma,x : P \vdash Q \in \textbf{Prop} & \\
\midrule
& \Gamma \vdash \Sigma\, x : P.Q & \\
\end{aligned}
\end{equation}



 It is called a setoid model since types are interpreted as setoids.
The solution to introduce the extensional equality is an object type theory defined inside the setoid model which serves as the metatheory. He also proved that the extended type theory generated from the metatheory is decidable and adequate, functional extensionality is
inhabited and it permits large elimination (defining a dependent type by recursion). Within this type theory,
introduction of quotient types is straightforward.

This model is different to a setoid model as an E-category, for instance
the one introduced by Hofmann \cite{hofmann1995interpretation} . An E-category is a category equipped with
an equivalence relation for homsets. To distinguish them, we call this
category \textbf{E-setoids}.  All morphisms of \textbf{E-setoids}
gives rise to types and they are cartesian closed, namely it is a a locally
cartesian closed category (LCCC). Not all morphisms in our category of setoids give
rise to types and it is not an LCCC. Every LCCC can serve as a model for categories with
families but not every category with families has to be an
LCCC. 

\todo{write why this model is not lccc explicitly. refer to Nicolais's
result}



\paragraph{The category of setoids is not a LCCC}

The pullback functor.

\begin{displaymath}
    \xymatrix{X' \ar[r]^{p} \ar[d]_{f^{*}(a)} & Y' \ar[d]^a \\
      X \ar[r]^f& Y }
\end{displaymath}


Observe that $X \rightarrow 1 \cong X$, therefore the pullback of y which is
$X/1 \rightarrow X \times Y / Y$ can be seen as a pullback of X of type $X \rightarrow
X/Y$.

The left adjoint to the pullback functor $f*$ is just the post
composition of $f$ written as $f \circ\_$ or $\Sigma_f$.

\begin{displaymath}
    \xymatrix{X' \ar@{=}[r] \ar[d]_{a} & X' \ar[d]^{\Sigma_f a} \\
      X \ar[r]^f& Y }
\end{displaymath}


However this setoid model is still a model for Type
Theory just like the groupoid model which is a generalisation of it.
To develop this model of type theory in Agda, we have implemented the
categories with families of setoids. 
We build a category with families of setoids to accommodate the types theory described in
\cite{alti:lics99}  so that it is possible to define quotient types
following Martin Hofmann's Paper \cite{hof:95:sm}.  Only necessary
part for the Setoid model will be present here.


\section{An implementation of categories with Families in Agda}

Following the work in \cite{alti:99}, we first define a
proof-irrelevant universe of propositions. We name it as \textbf{hProp}
since \textbf{Prop} is a  reserved word which can't be used and
\textbf{hProp} is a notion from Homotopy Type Theory which we will introduce later.

\section{hProp}
\input{./CwF/latex/hProp.tex}

\section{Category}

To define category of setoids we should define category first.

\input{./CwF/Cats/latex/Category.tex}

$isCategory$ contains all the laws for this structure to be a category, for instance the
associativity laws for composition.

\section{Category of setoids}


\input{./CwF/latex/CategoryOfSetoid.tex}


\section{categories with families of setoids}


A Category with families consists of a base category and a functor
\cite{clairambault2005categories}. We firstly define the categories with
families of sets in Agda  as a guidance for the one for setoids. We
would present the setoid one here since it is relevant.

\input{./CwF/latex/CwF-setoid.tex}

\section{What we can do in this model}

\section{Examples of types}

\input{./CwF/latex/CwF-ctd.tex}

\input{./CwF/latex/CwF-quotient.tex}





\section{Quotient types in setoid model}





\section{Observational equality}

%definitional distinct types

Later in in \cite{alti:ott-conf}, Altenkirch and McBride further
simplifies the setoid model by adopting McBride's heterogeneous
approach to equality. They identifies values up to observation rather than
  construction which is called observational equality. It is the
  propositional equality induced by the Setoid model.  In general we have a heterogeneous equality which
  compares terms of types which are different in construction. It only
  make sense when we can prove the types are the same. It helps us
  avoids the heavy use of $subst$ which makes formalisation and
  reasoning involved. We could simplify the setoid model by adapting this
  approach and the implementation could be easier.
